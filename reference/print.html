<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>DiveScript reference</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="notation.html"><strong aria-hidden="true">1.</strong> Notation</a></li><li class="chapter-item expanded "><a href="lexical-structure.html"><strong aria-hidden="true">2.</strong> Lexical structure</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="input-format.html"><strong aria-hidden="true">2.1.</strong> Input format</a></li><li class="chapter-item expanded "><a href="keywords.html"><strong aria-hidden="true">2.2.</strong> Keywords</a></li><li class="chapter-item expanded "><a href="identifiers.html"><strong aria-hidden="true">2.3.</strong> Identifiers</a></li><li class="chapter-item expanded "><a href="comments.html"><strong aria-hidden="true">2.4.</strong> Comments</a></li><li class="chapter-item expanded "><a href="whitespace.html"><strong aria-hidden="true">2.5.</strong> Whitespace</a></li><li class="chapter-item expanded "><a href="tokens.html"><strong aria-hidden="true">2.6.</strong> Tokens</a></li></ol></li><li class="chapter-item expanded "><a href="macros.html"><strong aria-hidden="true">3.</strong> Macros</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="macros-by-example.html"><strong aria-hidden="true">3.1.</strong> Macros by Example</a></li><li class="chapter-item expanded "><a href="procedural-macros.html"><strong aria-hidden="true">3.2.</strong> Procedural Macros</a></li></ol></li><li class="chapter-item expanded "><a href="crates-and-source-files.html"><strong aria-hidden="true">4.</strong> Crates and source files</a></li><li class="chapter-item expanded "><a href="conditional-compilation.html"><strong aria-hidden="true">5.</strong> Conditional compilation</a></li><li class="chapter-item expanded "><a href="items.html"><strong aria-hidden="true">6.</strong> Items</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="items/modules.html"><strong aria-hidden="true">6.1.</strong> Modules</a></li><li class="chapter-item expanded "><a href="items/use-declarations.html"><strong aria-hidden="true">6.2.</strong> Use declarations</a></li><li class="chapter-item expanded "><a href="items/functions.html"><strong aria-hidden="true">6.3.</strong> Functions</a></li><li class="chapter-item expanded "><a href="items/type-aliases.html"><strong aria-hidden="true">6.4.</strong> Type aliases</a></li><li class="chapter-item expanded "><a href="items/structs.html"><strong aria-hidden="true">6.5.</strong> Structs</a></li><li class="chapter-item expanded "><a href="items/enumerations.html"><strong aria-hidden="true">6.6.</strong> Enumerations</a></li><li class="chapter-item expanded "><a href="items/constant-items.html"><strong aria-hidden="true">6.7.</strong> Constant items</a></li><li class="chapter-item expanded "><a href="items/static-items.html"><strong aria-hidden="true">6.8.</strong> Static items</a></li><li class="chapter-item expanded "><a href="items/traits.html"><strong aria-hidden="true">6.9.</strong> Traits</a></li><li class="chapter-item expanded "><a href="items/implementations.html"><strong aria-hidden="true">6.10.</strong> Implementations</a></li><li class="chapter-item expanded "><a href="items/generics.html"><strong aria-hidden="true">6.11.</strong> Generic parameters</a></li><li class="chapter-item expanded "><a href="items/associated-items.html"><strong aria-hidden="true">6.12.</strong> Associated items</a></li></ol></li><li class="chapter-item expanded "><a href="inheritance.html"><strong aria-hidden="true">7.</strong> Inheritance</a></li><li class="chapter-item expanded "><a href="serialization.html"><strong aria-hidden="true">8.</strong> Serialization</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">DiveScript reference</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="notation"><a class="header" href="#notation">Notation</a></h1>
<h2 id="grammar"><a class="header" href="#grammar">Grammar</a></h2>
<p>The following notations are used by the <em>Lexer</em> and <em>Syntax</em> grammar snippets:</p>
<div class="table-wrapper"><table><thead><tr><th>Notation</th><th>Examples</th><th>Meaning</th></tr></thead><tbody>
<tr><td>CAPITAL</td><td>KW_IF, INTEGER_LITERAL</td><td>A token produced by the lexer</td></tr>
<tr><td><em>ItalicCamelCase</em></td><td><em>LetStatement</em>, <em>Item</em></td><td>A syntactical production</td></tr>
<tr><td><code>string</code></td><td><code>x</code>, <code>while</code>, <code>*</code></td><td>The exact character(s)</td></tr>
<tr><td>\x</td><td>\n, \r, \t, \0</td><td>The character represented by this escape</td></tr>
<tr><td>x<sup>?</sup></td><td><code>pub</code><sup>?</sup></td><td>An optional item</td></tr>
<tr><td>x<sup>*</sup></td><td><em>OuterAttribute</em><sup>*</sup></td><td>0 or more of x</td></tr>
<tr><td>x<sup>+</sup></td><td><em>MacroMatch</em><sup>+</sup></td><td>1 or more of x</td></tr>
<tr><td>x<sup>a..b</sup></td><td>HEX_DIGIT<sup>1..6</sup></td><td>a to b repetitions of x</td></tr>
<tr><td>|</td><td><code>u8</code> | <code>u16</code>, Block | Item</td><td>Either one or another</td></tr>
<tr><td>[ ]</td><td>[<code>b</code> <code>B</code>]</td><td>Any of the characters listed</td></tr>
<tr><td>[ - ]</td><td>[<code>a</code>-<code>z</code>]</td><td>Any of the characters in the range</td></tr>
<tr><td>~[ ]</td><td>~[<code>b</code> <code>B</code>]</td><td>Any characters, except those listed</td></tr>
<tr><td>~<code>string</code></td><td>~<code>\n</code>, ~<code>*/</code></td><td>Any characters, except this sequence</td></tr>
<tr><td>( )</td><td>(<code>,</code> <em>Parameter</em>)<sup>?</sup></td><td>Groups items</td></tr>
</tbody></table>
</div>
<h2 id="string-table-productions"><a class="header" href="#string-table-productions">String table productions</a></h2>
<p>Some rules in the grammar — notably <a href="expressions/operator-expr.html#arithmetic-and-logical-binary-operators">binary
operators</a>, and <a href="keywords.html">keywords</a> — are given in a simplified form: as a listing
of printable strings. These cases form a subset of the rules regarding the
<a href="tokens.html">token</a> rule, and are assumed to be the result of a lexical-analysis
phase feeding the parser, driven by a <abbr title="Deterministic Finite
Automaton">DFA</abbr>, operating over the disjunction of all such string table
entries.</p>
<p>When such a string in <code>monospace</code> font occurs inside the grammar,
it is an implicit reference to a single member of such a string table
production. See <a href="tokens.html">tokens</a> for more information.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="lexical-structure"><a class="header" href="#lexical-structure">Lexical structure</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="input-format"><a class="header" href="#input-format">Input format</a></h1>
<p>DS input is interpreted as a sequence of Unicode code points encoded in UTF-8.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="keywords"><a class="header" href="#keywords">Keywords</a></h1>
<p>DS divides keywords into three categories:</p>
<ul>
<li><a href="keywords.html#strict-keywords">strict</a></li>
<li><a href="keywords.html#reserved-keywords">reserved</a></li>
<li><a href="keywords.html#weak-keywords">weak</a></li>
</ul>
<h2 id="strict-keywords"><a class="header" href="#strict-keywords">Strict keywords</a></h2>
<p>These keywords can only be used in their correct contexts. They cannot
be used as the names of:</p>
<ul>
<li><a href="items.html">Items</a></li>
<li><a href="variables.html">Variables</a> and function parameters</li>
<li>Fields and <a href="items/enumerations.html">variants</a></li>
<li><a href="types/parameters.html">Type parameters</a></li>
<li><a href="expressions/loop-expr.html#loop-labels">Loop labels</a></li>
<li><a href="macros.html">Macros</a> or <a href="attributes.html">attributes</a></li>
<li><a href="macros-by-example.html">Macro placeholders</a></li>
<li><a href="crates-and-source-files.html">Crates</a></li>
</ul>
<blockquote>
<p><strong><sup>Lexer:<sup></strong><br />
KW_AS             : <code>as</code><br />
KW_ASYNC          : <code>async</code><br />
KW_AWAIT          : <code>await</code><br />
KW_BREAK          : <code>break</code><br />
KW_CONST          : <code>const</code><br />
KW_CONTINUE       : <code>continue</code><br />
KW_CRATE          : <code>crate</code><br />
KW_ELSE           : <code>else</code><br />
KW_ENUM           : <code>enum</code><br />
KW_EXTERN         : <code>extern</code><br />
KW_FALSE          : <code>false</code><br />
KW_FN             : <code>fn</code><br />
KW_FOR            : <code>for</code><br />
KW_IF             : <code>if</code><br />
KW_IMPL           : <code>impl</code><br />
KW_IN             : <code>in</code><br />
KW_LET            : <code>let</code><br />
KW_LOOP           : <code>loop</code><br />
KW_MACRO          : <code>macro</code><br />
KW_MATCH          : <code>match</code><br />
KW_MOD            : <code>mod</code><br />
KW_MUT            : <code>mut</code><br />
KW_OVERRIDE       : <code>override</code><br />
KW_PUB            : <code>pub</code><br />
KW_RETURN         : <code>return</code><br />
KW_SELFVALUE      : <code>self</code><br />
KW_SELFTYPE       : <code>Self</code><br />
KW_STATIC         : <code>static</code><br />
KW_STRUCT         : <code>struct</code><br />
KW_SUPER          : <code>super</code><br />
KW_TRAIT          : <code>trait</code><br />
KW_TRUE           : <code>true</code><br />
KW_TRY            : <code>try</code><br />
KW_TYPE           : <code>type</code><br />
KW_USE            : <code>use</code><br />
KW_WHERE          : <code>where</code><br />
KW_WHILE          : <code>while</code> <br />
KW_YIELD          : <code>yield</code></p>
</blockquote>
<h2 id="reserved-keywords"><a class="header" href="#reserved-keywords">Reserved keywords</a></h2>
<p>These keywords aren't used yet, but they are reserved for future use. They have
the same restrictions as strict keywords. The reasoning behind this is to make
current programs forward compatible with future versions of DS by forbidding
them to use these keywords.</p>
<blockquote>
<p><strong><sup>Lexer</sup></strong><br />
KW_DO             : <code>do</code><br />
KW_FINAL          : <code>final</code><br />
KW_PRIV           : <code>priv</code><br />
KW_TYPEOF         : <code>typeof</code></p>
</blockquote>
<h2 id="weak-keywords"><a class="header" href="#weak-keywords">Weak keywords</a></h2>
<p>These keywords have special meaning only in certain contexts.</p>
<blockquote>
<p>Empty: DS has no weak keywords currently.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="identifiers"><a class="header" href="#identifiers">Identifiers</a></h1>
<blockquote>
<p><strong><sup>Lexer:<sup></strong><br />
IDENTIFIER_OR_KEYWORD :<br />
      XID_Start XID_Continue<sup>*</sup><br />
   | <code>_</code> XID_Continue<sup>+</sup></p>
<p>RAW_IDENTIFIER : <code>r#</code> IDENTIFIER_OR_KEYWORD <sub><em>Except <code>crate</code>, <code>self</code>, <code>super</code>, <code>Self</code></em></sub></p>
<p>NON_KEYWORD_IDENTIFIER : IDENTIFIER_OR_KEYWORD <sub><em>Except a <a href="keywords.html#strict-keywords">strict</a> or <a href="keywords.html#reserved-keywords">reserved</a> keyword</em></sub></p>
<p>IDENTIFIER :<br />
NON_KEYWORD_IDENTIFIER | RAW_IDENTIFIER</p>
</blockquote>
<!-- When updating the version, update the UAX links, too. -->
<p>Identifiers follow the specification in <a href="https://www.unicode.org/reports/tr31/tr31-37.html">Unicode Standard Annex #31</a> for Unicode version 15.0, with the additions described below. Some examples of identifiers:</p>
<ul>
<li><code>foo</code></li>
<li><code>_identifier</code></li>
<li><code>r#true</code></li>
<li><code>Москва</code></li>
<li><code>東京</code></li>
</ul>
<p>The profile used from UAX #31 is:</p>
<ul>
<li>Start := <a href="http://unicode.org/cldr/utility/list-unicodeset.jsp?a=%5B%3AXID_Start%3A%5D&amp;abb=on&amp;g=&amp;i="><code>XID_Start</code></a>, plus the underscore character (U+005F)</li>
<li>Continue := <a href="http://unicode.org/cldr/utility/list-unicodeset.jsp?a=%5B%3AXID_Continue%3A%5D&amp;abb=on&amp;g=&amp;i="><code>XID_Continue</code></a></li>
<li>Medial := empty</li>
</ul>
<p>with the additional constraint that a single underscore character is not an identifier.</p>
<blockquote>
<p><strong>Note</strong>: Identifiers starting with an underscore are typically used to indicate an identifier that is intentionally unused, and will silence the unused warning in <code>rustc</code>.</p>
</blockquote>
<p>Identifiers may not be a <a href="keywords.html#strict-keywords">strict</a> or <a href="keywords.html#reserved-keywords">reserved</a> keyword without the <code>r#</code> prefix described below in <a href="identifiers.html#raw-identifiers">raw identifiers</a>.</p>
<p>Zero width non-joiner (ZWNJ U+200C) and zero width joiner (ZWJ U+200D) characters are not allowed in identifiers.</p>
<h2 id="normalization"><a class="header" href="#normalization">Normalization</a></h2>
<p>Identifiers are normalized using Normalization Form C (NFC) as defined in <a href="https://www.unicode.org/reports/tr15/tr15-53.html">Unicode Standard Annex #15</a>. Two identifiers are equal if their NFC forms are equal.</p>
<p><a href="procedural-macros.html">Procedural</a> and <a href="macros-by-example.html">declarative</a> macros receive normalized identifiers in their input.</p>
<h2 id="raw-identifiers"><a class="header" href="#raw-identifiers">Raw identifiers</a></h2>
<p>A raw identifier is like a normal identifier, but prefixed by <code>r#</code>. (Note that
the <code>r#</code> prefix is not included as part of the actual identifier.)
Unlike a normal identifier, a raw identifier may be any strict or reserved
keyword except the ones listed above for <code>RAW_IDENTIFIER</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="comments"><a class="header" href="#comments">Comments</a></h1>
<blockquote>
<p><strong><sup>Lexer</sup></strong><br />
LINE_COMMENT :<br />
      <code>//</code> (~[<code>/</code> <code>!</code> <code>\n</code>] | <code>//</code>) ~<code>\n</code><sup>*</sup><br />
   | <code>//</code></p>
<p>BLOCK_COMMENT :<br />
      <code>/*</code> (~[<code>*</code> <code>!</code>] | <code>**</code> | <em>BlockCommentOrDoc</em>)
(<em>BlockCommentOrDoc</em> | ~<code>*/</code>)<sup>*</sup> <code>*/</code><br />
   | <code>/**/</code><br />
   | <code>/***/</code></p>
<p>INNER_LINE_DOC :<br />
   <code>//!</code> ~[<code>\n</code> <em>IsolatedCR</em>]<sup>*</sup></p>
<p>INNER_BLOCK_DOC :<br />
   <code>/*!</code> ( <em>BlockCommentOrDoc</em> | ~[<code>*/</code> <em>IsolatedCR</em>] )<sup>*</sup> <code>*/</code></p>
<p>OUTER_LINE_DOC :<br />
   <code>///</code> (~<code>/</code> ~[<code>\n</code> <em>IsolatedCR</em>]<sup>*</sup>)<sup>?</sup></p>
<p>OUTER_BLOCK_DOC :<br />
   <code>/**</code> (~<code>*</code> | <em>BlockCommentOrDoc</em> )
(<em>BlockCommentOrDoc</em> | ~[<code>*/</code> <em>IsolatedCR</em>])<sup>*</sup> <code>*/</code></p>
<p><em>BlockCommentOrDoc</em> :<br />
      BLOCK_COMMENT<br />
   | OUTER_BLOCK_DOC<br />
   | INNER_BLOCK_DOC</p>
<p><em>IsolatedCR</em> :<br />
   <em>A <code>\r</code> not followed by a <code>\n</code></em></p>
</blockquote>
<h2 id="non-doc-comments"><a class="header" href="#non-doc-comments">Non-doc comments</a></h2>
<p>Comments follow the general C++ style of line (<code>//</code>) and
block (<code>/* ... */</code>) comment forms. Nested block comments are supported.</p>
<p>Non-doc comments are interpreted as a form of whitespace.</p>
<h2 id="doc-comments"><a class="header" href="#doc-comments">Doc comments</a></h2>
<p>Line doc comments beginning with exactly <em>three</em> slashes (<code>///</code>), and block
doc comments (<code>/** ... */</code>), both outer doc comments, are interpreted as a
special syntax for <a href="../dsdoc/the-doc-attribute.html"><code>doc</code> attributes</a>. That is, they are equivalent to writing
<code>#[doc=&quot;...&quot;]</code> around the body of the comment, i.e., <code>/// Foo</code> turns into
<code>#[doc=&quot;Foo&quot;]</code> and <code>/** Bar */</code> turns into <code>#[doc=&quot;Bar&quot;]</code>.</p>
<p>Line comments beginning with <code>//!</code> and block comments <code>/*! ... */</code> are
doc comments that apply to the parent of the comment, rather than the item
that follows.  That is, they are equivalent to writing <code>#![doc=&quot;...&quot;]</code> around
the body of the comment. <code>//!</code> comments are usually used to document
modules that occupy a source file.</p>
<p>Isolated CRs (<code>\r</code>), i.e. not followed by LF (<code>\n</code>), are not allowed in doc
comments.</p>
<h2 id="examples"><a class="header" href="#examples">Examples</a></h2>
<pre><code class="language-ds">//! A doc comment that applies to the implicit anonymous module of this crate

pub mod outer_module {

    //!  - Inner line doc
    //!! - Still an inner line doc (but with a bang at the beginning)

    /*!  - Inner block doc */
    /*!! - Still an inner block doc (but with a bang at the beginning) */

    //   - Only a comment
    ///  - Outer line doc (exactly 3 slashes)
    //// - Only a comment

    /*   - Only a comment */
    /**  - Outer block doc (exactly) 2 asterisks */
    /*** - Only a comment */

    pub mod inner_module {}

    pub mod nested_comments {
        /* In DS /* we can /* nest comments */ */ */

        // All three types of block comments can contain or be nested inside
        // any other type:

        /*   /* */  /** */  /*! */  */
        /*!  /* */  /** */  /*! */  */
        /**  /* */  /** */  /*! */  */
        pub mod dummy_item {}
    }

    pub mod degenerate_cases {
        // empty inner line doc
        //!

        // empty inner block doc
        /*!*/

        // empty line comment
        //

        // empty outer line doc
        ///

        // empty block comment
        /**/

        pub mod dummy_item {}

        // empty 2-asterisk block isn't a doc block, it is a block comment
        /***/

    }

    /* The next one isn't allowed because outer doc comments
       require an item that will receive the doc */

    /// Where is my item?
#   mod boo {}
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="whitespace"><a class="header" href="#whitespace">Whitespace</a></h1>
<p>Whitespace is any non-empty string containing only characters that have the
<a href="https://www.unicode.org/reports/tr31/"><code>Pattern_White_Space</code></a> Unicode property, namely:</p>
<ul>
<li><code>U+0009</code> (horizontal tab, <code>'\t'</code>)</li>
<li><code>U+000A</code> (line feed, <code>'\n'</code>)</li>
<li><code>U+000B</code> (vertical tab)</li>
<li><code>U+000C</code> (form feed)</li>
<li><code>U+000D</code> (carriage return, <code>'\r'</code>)</li>
<li><code>U+0020</code> (space, <code>' '</code>)</li>
<li><code>U+0085</code> (next line)</li>
<li><code>U+200E</code> (left-to-right mark)</li>
<li><code>U+200F</code> (right-to-left mark)</li>
<li><code>U+2028</code> (line separator)</li>
<li><code>U+2029</code> (paragraph separator)</li>
</ul>
<p>DS is a &quot;free-form&quot; language, meaning that all forms of whitespace serve only
to separate <em>tokens</em> in the grammar, and have no semantic significance.</p>
<p>An DS program has identical meaning if each whitespace element is replaced
with any other legal whitespace element, such as a single space character.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tokens"><a class="header" href="#tokens">Tokens</a></h1>
<p>Tokens are primitive productions in the grammar defined by regular
(non-recursive) languages. DS source input can be broken down
into the following kinds of tokens:</p>
<ul>
<li><a href="keywords.html">Keywords</a></li>
<li><a href="identifiers.html">Identifiers</a></li>
<li><a href="tokens.html#literals">Literals</a></li>
<li><a href="tokens.html#loop-labels">Loop labels</a></li>
<li><a href="tokens.html#punctuation">Punctuation</a></li>
<li><a href="tokens.html#delimiters">Delimiters</a></li>
</ul>
<p>Within this documentation's grammar, &quot;simple&quot; tokens are given in <a href="notation.html#string-table-productions">string
table production</a> form, and appear in <code>monospace</code> font.</p>
<h2 id="literals"><a class="header" href="#literals">Literals</a></h2>
<p>Literals are tokens used in <a href="expressions/literal-expr.html">literal expressions</a>.</p>
<h3 id="examples-1"><a class="header" href="#examples-1">Examples</a></h3>
<h4 id="characters-and-strings"><a class="header" href="#characters-and-strings">Characters and strings</a></h4>
<div class="table-wrapper"><table><thead><tr><th></th><th>Example</th><th><code>#</code> sets*</th><th>Characters</th><th>Escapes</th></tr></thead><tbody>
<tr><td><a href="tokens.html#character-literals">Character</a></td><td><code>'H'</code></td><td>0</td><td>All Unicode</td><td><a href="tokens.html#quote-escapes">Quote</a> &amp; <a href="tokens.html#ascii-escapes">ASCII</a> &amp; <a href="tokens.html#unicode-escapes">Unicode</a></td></tr>
<tr><td><a href="tokens.html#string-literals">String</a></td><td><code>&quot;hello&quot;</code></td><td>0</td><td>All Unicode</td><td><a href="tokens.html#quote-escapes">Quote</a> &amp; <a href="tokens.html#ascii-escapes">ASCII</a> &amp; <a href="tokens.html#unicode-escapes">Unicode</a></td></tr>
<tr><td><a href="tokens.html#raw-string-literals">Raw string</a></td><td><code>r#&quot;hello&quot;#</code></td><td>&lt;256</td><td>All Unicode</td><td><code>N/A</code></td></tr>
<tr><td><a href="tokens.html#byte-literals">Byte</a></td><td><code>b'H'</code></td><td>0</td><td>All ASCII</td><td><a href="tokens.html#quote-escapes">Quote</a> &amp; <a href="tokens.html#byte-escapes">Byte</a></td></tr>
<tr><td><a href="tokens.html#byte-string-literals">Byte string</a></td><td><code>b&quot;hello&quot;</code></td><td>0</td><td>All ASCII</td><td><a href="tokens.html#quote-escapes">Quote</a> &amp; <a href="tokens.html#byte-escapes">Byte</a></td></tr>
<tr><td><a href="tokens.html#raw-byte-string-literals">Raw byte string</a></td><td><code>br#&quot;hello&quot;#</code></td><td>&lt;256</td><td>All ASCII</td><td><code>N/A</code></td></tr>
</tbody></table>
</div>
<p>* The number of <code>#</code>s on each side of the same literal must be equivalent.</p>
<h4 id="ascii-escapes"><a class="header" href="#ascii-escapes">ASCII escapes</a></h4>
<div class="table-wrapper"><table><thead><tr><th></th><th>Name</th></tr></thead><tbody>
<tr><td><code>\x41</code></td><td>7-bit character code (exactly 2 digits, up to 0x7F)</td></tr>
<tr><td><code>\n</code></td><td>Newline</td></tr>
<tr><td><code>\r</code></td><td>Carriage return</td></tr>
<tr><td><code>\t</code></td><td>Tab</td></tr>
<tr><td><code>\\</code></td><td>Backslash</td></tr>
<tr><td><code>\0</code></td><td>Null</td></tr>
</tbody></table>
</div>
<h4 id="byte-escapes"><a class="header" href="#byte-escapes">Byte escapes</a></h4>
<div class="table-wrapper"><table><thead><tr><th></th><th>Name</th></tr></thead><tbody>
<tr><td><code>\x7F</code></td><td>8-bit character code (exactly 2 digits)</td></tr>
<tr><td><code>\n</code></td><td>Newline</td></tr>
<tr><td><code>\r</code></td><td>Carriage return</td></tr>
<tr><td><code>\t</code></td><td>Tab</td></tr>
<tr><td><code>\\</code></td><td>Backslash</td></tr>
<tr><td><code>\0</code></td><td>Null</td></tr>
</tbody></table>
</div>
<h4 id="unicode-escapes"><a class="header" href="#unicode-escapes">Unicode escapes</a></h4>
<div class="table-wrapper"><table><thead><tr><th></th><th>Name</th></tr></thead><tbody>
<tr><td><code>\u{7FFF}</code></td><td>24-bit Unicode character code (up to 6 digits)</td></tr>
</tbody></table>
</div>
<h4 id="quote-escapes"><a class="header" href="#quote-escapes">Quote escapes</a></h4>
<div class="table-wrapper"><table><thead><tr><th></th><th>Name</th></tr></thead><tbody>
<tr><td><code>\'</code></td><td>Single quote</td></tr>
<tr><td><code>\&quot;</code></td><td>Double quote</td></tr>
</tbody></table>
</div>
<h4 id="numbers"><a class="header" href="#numbers">Numbers</a></h4>
<div class="table-wrapper"><table><thead><tr><th><a href="tokens.html#number-literals">Number literals</a><code>*</code></th><th>Example</th><th>Exponentiation</th></tr></thead><tbody>
<tr><td>Decimal integer</td><td><code>98_222</code></td><td><code>N/A</code></td></tr>
<tr><td>Hex integer</td><td><code>0xff</code></td><td><code>N/A</code></td></tr>
<tr><td>Octal integer</td><td><code>0o77</code></td><td><code>N/A</code></td></tr>
<tr><td>Binary integer</td><td><code>0b1111_0000</code></td><td><code>N/A</code></td></tr>
<tr><td>Floating-point</td><td><code>123.0E+77</code></td><td><code>Optional</code></td></tr>
</tbody></table>
</div>
<p><code>*</code> All number literals allow <code>_</code> as a visual separator: <code>1_234.0E+18f64</code></p>
<h4 id="suffixes"><a class="header" href="#suffixes">Suffixes</a></h4>
<p>A suffix is a sequence of characters following the primary part of a literal (without intervening whitespace), of the same form as a non-raw identifier or keyword.</p>
<blockquote>
<p><strong><sup>Lexer</sup></strong><br />
SUFFIX : IDENTIFIER_OR_KEYWORD<br />
SUFFIX_NO_E : SUFFIX <sub><em>not beginning with <code>e</code> or <code>E</code></em></sub></p>
</blockquote>
<p>Any kind of literal (string, integer, etc) with any suffix is valid as a token.</p>
<p>A literal token with any suffix can be passed to a macro without producing an error.
The macro itself will decide how to interpret such a token and whether to produce an error or not.
In particular, the <code>literal</code> fragment specifier for by-example macros matches literal tokens with arbitrary suffixes.</p>
<pre><code class="language-ds">macro blackhole { ($tt:tt) =&gt; () }
macro blackhole_lit { ($l:literal) =&gt; () }

blackhole!(&quot;string&quot;suffix); // OK
blackhole_lit!(1suffix); // OK
</code></pre>
<p>However, suffixes on literal tokens which are interpreted as literal expressions or patterns are restricted.
Any suffixes are rejected on non-numeric literal tokens,
and numeric literal tokens are accepted only with suffixes from the list below.</p>
<div class="table-wrapper"><table><thead><tr><th>Integer</th><th>Floating-point</th></tr></thead><tbody>
<tr><td><code>u32</code>, <code>i32</code>, <code>f64</code></td><td></td></tr>
</tbody></table>
</div>
<h3 id="character-and-string-literals"><a class="header" href="#character-and-string-literals">Character and string literals</a></h3>
<h4 id="character-literals"><a class="header" href="#character-literals">Character literals</a></h4>
<blockquote>
<p><strong><sup>Lexer</sup></strong><br />
CHAR_LITERAL :<br />
   <code>'</code> ( ~[<code>'</code> <code>\</code> \n \r \t] | QUOTE_ESCAPE | ASCII_ESCAPE | UNICODE_ESCAPE ) <code>'</code> SUFFIX<sup>?</sup></p>
<p>QUOTE_ESCAPE :<br />
   <code>\'</code> | <code>\&quot;</code></p>
<p>ASCII_ESCAPE :<br />
      <code>\x</code> OCT_DIGIT HEX_DIGIT<br />
   | <code>\n</code> | <code>\r</code> | <code>\t</code> | <code>\\</code> | <code>\0</code></p>
<p>UNICODE_ESCAPE :<br />
   <code>\u{</code> ( HEX_DIGIT <code>_</code><sup>*</sup> )<sup>1..6</sup> <code>}</code></p>
</blockquote>
<p>A <em>character literal</em> is a single Unicode character enclosed within two
<code>U+0027</code> (single-quote) characters, with the exception of <code>U+0027</code> itself,
which must be <em>escaped</em> by a preceding <code>U+005C</code> character (<code>\</code>).</p>
<h4 id="string-literals"><a class="header" href="#string-literals">String literals</a></h4>
<blockquote>
<p><strong><sup>Lexer</sup></strong><br />
STRING_LITERAL :<br />
   <code>&quot;</code> (<br />
      ~[<code>&quot;</code> <code>\</code> <em>IsolatedCR</em>]<br />
      | QUOTE_ESCAPE<br />
      | ASCII_ESCAPE<br />
      | UNICODE_ESCAPE<br />
      | STRING_CONTINUE<br />
   )<sup>*</sup> <code>&quot;</code> SUFFIX<sup>?</sup></p>
<p>STRING_CONTINUE :<br />
   <code>\</code> <em>followed by</em> \n</p>
</blockquote>
<p>A <em>string literal</em> is a sequence of any Unicode characters enclosed within two
<code>U+0022</code> (double-quote) characters, with the exception of <code>U+0022</code> itself,
which must be <em>escaped</em> by a preceding <code>U+005C</code> character (<code>\</code>).</p>
<p>Line-breaks are allowed in string literals. A line-break is either a newline
(<code>U+000A</code>) or a pair of carriage return and newline (<code>U+000D</code>, <code>U+000A</code>). Both
byte sequences are normally translated to <code>U+000A</code>, but as a special exception,
when an unescaped <code>U+005C</code> character (<code>\</code>) occurs immediately before a line
break, then the line break character(s), and all immediately following
<code> </code> (<code>U+0020</code>), <code>\t</code> (<code>U+0009</code>), <code>\n</code> (<code>U+000A</code>) and <code>\r</code> (<code>U+0000D</code>) characters
are ignored. Thus <code>a</code>, <code>b</code> and <code>c</code> are equal:</p>
<pre><code class="language-ds">let a = &quot;foobar&quot;;
let b = &quot;foo\
         bar&quot;;
let c = &quot;foo\

     bar&quot;;

assert_eq!(a, b);
assert_eq!(b, c);
</code></pre>
<h4 id="character-escapes"><a class="header" href="#character-escapes">Character escapes</a></h4>
<p>Some additional <em>escapes</em> are available in either character or non-raw string
literals. An escape starts with a <code>U+005C</code> (<code>\</code>) and continues with one of the
following forms:</p>
<ul>
<li>A <em>7-bit code point escape</em> starts with <code>U+0078</code> (<code>x</code>) and is
followed by exactly two <em>hex digits</em> with value up to <code>0x7F</code>. It denotes the
ASCII character with value equal to the provided hex value. Higher values are
not permitted because it is ambiguous whether they mean Unicode code points or
byte values.</li>
<li>A <em>24-bit code point escape</em> starts with <code>U+0075</code> (<code>u</code>) and is followed
by up to six <em>hex digits</em> surrounded by braces <code>U+007B</code> (<code>{</code>) and <code>U+007D</code>
(<code>}</code>). It denotes the Unicode code point equal to the provided hex value.</li>
<li>A <em>whitespace escape</em> is one of the characters <code>U+006E</code> (<code>n</code>), <code>U+0072</code>
(<code>r</code>), or <code>U+0074</code> (<code>t</code>), denoting the Unicode values <code>U+000A</code> (LF),
<code>U+000D</code> (CR) or <code>U+0009</code> (HT) respectively.</li>
<li>The <em>null escape</em> is the character <code>U+0030</code> (<code>0</code>) and denotes the Unicode
value <code>U+0000</code> (NUL).</li>
<li>The <em>backslash escape</em> is the character <code>U+005C</code> (<code>\</code>) which must be
escaped in order to denote itself.</li>
</ul>
<h4 id="raw-string-literals"><a class="header" href="#raw-string-literals">Raw string literals</a></h4>
<blockquote>
<p><strong><sup>Lexer</sup></strong><br />
RAW_STRING_LITERAL :<br />
   <code>r</code> RAW_STRING_CONTENT SUFFIX<sup>?</sup></p>
<p>RAW_STRING_CONTENT :<br />
      <code>&quot;</code> ( ~ <em>IsolatedCR</em> )<sup>* (non-greedy)</sup> <code>&quot;</code><br />
   | <code>#</code> RAW_STRING_CONTENT <code>#</code></p>
</blockquote>
<p>Raw string literals do not process any escapes. They start with the character
<code>U+0072</code> (<code>r</code>), followed by fewer than 256 of the character <code>U+0023</code> (<code>#</code>) and a
<code>U+0022</code> (double-quote) character. The <em>raw string body</em> can contain any sequence
of Unicode characters and is terminated only by another <code>U+0022</code> (double-quote)
character, followed by the same number of <code>U+0023</code> (<code>#</code>) characters that preceded
the opening <code>U+0022</code> (double-quote) character.</p>
<p>All Unicode characters contained in the raw string body represent themselves,
the characters <code>U+0022</code> (double-quote) (except when followed by at least as
many <code>U+0023</code> (<code>#</code>) characters as were used to start the raw string literal) or
<code>U+005C</code> (<code>\</code>) do not have any special meaning.</p>
<p>Examples for string literals:</p>
<pre><code class="language-ds">&quot;foo&quot;; r&quot;foo&quot;;                     // foo
&quot;\&quot;foo\&quot;&quot;; r#&quot;&quot;foo&quot;&quot;#;             // &quot;foo&quot;

&quot;foo #\&quot;# bar&quot;;
r##&quot;foo #&quot;# bar&quot;##;                // foo #&quot;# bar

&quot;\x52&quot;; &quot;R&quot;; r&quot;R&quot;;                 // R
&quot;\\x52&quot;; r&quot;\x52&quot;;                  // \x52
</code></pre>
<h3 id="byte-and-byte-string-literals"><a class="header" href="#byte-and-byte-string-literals">Byte and byte string literals</a></h3>
<h4 id="byte-literals"><a class="header" href="#byte-literals">Byte literals</a></h4>
<blockquote>
<p><strong><sup>Lexer</sup></strong><br />
BYTE_LITERAL :<br />
   <code>b'</code> ( ASCII_FOR_CHAR | BYTE_ESCAPE )  <code>'</code> SUFFIX<sup>?</sup></p>
<p>ASCII_FOR_CHAR :<br />
   <em>any ASCII (i.e. 0x00 to 0x7F), except</em> <code>'</code>, <code>\</code>, \n, \r or \t</p>
<p>BYTE_ESCAPE :<br />
      <code>\x</code> HEX_DIGIT HEX_DIGIT<br />
   | <code>\n</code> | <code>\r</code> | <code>\t</code> | <code>\\</code> | <code>\0</code> | <code>\'</code> | <code>\&quot;</code></p>
</blockquote>
<p>A <em>byte literal</em> is a single ASCII character (in the <code>U+0000</code> to <code>U+007F</code>
range) or a single <em>escape</em> preceded by the characters <code>U+0062</code> (<code>b</code>) and
<code>U+0027</code> (single-quote), and followed by the character <code>U+0027</code>. If the character
<code>U+0027</code> is present within the literal, it must be <em>escaped</em> by a preceding
<code>U+005C</code> (<code>\</code>) character. It is equivalent to a <code>u32</code> unsigned 32-bit integer
<em>number literal</em>.</p>
<h4 id="byte-string-literals"><a class="header" href="#byte-string-literals">Byte string literals</a></h4>
<blockquote>
<p><strong><sup>Lexer</sup></strong><br />
BYTE_STRING_LITERAL :<br />
   <code>b&quot;</code> ( ASCII_FOR_STRING | BYTE_ESCAPE | STRING_CONTINUE )<sup>*</sup> <code>&quot;</code> SUFFIX<sup>?</sup></p>
<p>ASCII_FOR_STRING :<br />
   <em>any ASCII (i.e 0x00 to 0x7F), except</em> <code>&quot;</code>, <code>\</code> <em>and IsolatedCR</em></p>
</blockquote>
<p>A non-raw <em>byte string literal</em> is a sequence of ASCII characters and <em>escapes</em>,
preceded by the characters <code>U+0062</code> (<code>b</code>) and <code>U+0022</code> (double-quote), and
followed by the character <code>U+0022</code>. If the character <code>U+0022</code> is present within
the literal, it must be <em>escaped</em> by a preceding <code>U+005C</code> (<code>\</code>) character.
Alternatively, a byte string literal can be a <em>raw byte string literal</em>, defined
below. The type of a byte string literal is <code>Bytes</code>.</p>
<p>Some additional <em>escapes</em> are available in either byte or non-raw byte string
literals. An escape starts with a <code>U+005C</code> (<code>\</code>) and continues with one of the
following forms:</p>
<ul>
<li>A <em>byte escape</em> escape starts with <code>U+0078</code> (<code>x</code>) and is
followed by exactly two <em>hex digits</em>. It denotes the byte
equal to the provided hex value.</li>
<li>A <em>whitespace escape</em> is one of the characters <code>U+006E</code> (<code>n</code>), <code>U+0072</code>
(<code>r</code>), or <code>U+0074</code> (<code>t</code>), denoting the bytes values <code>0x0A</code> (ASCII LF),
<code>0x0D</code> (ASCII CR) or <code>0x09</code> (ASCII HT) respectively.</li>
<li>The <em>null escape</em> is the character <code>U+0030</code> (<code>0</code>) and denotes the byte
value <code>0x00</code> (ASCII NUL).</li>
<li>The <em>backslash escape</em> is the character <code>U+005C</code> (<code>\</code>) which must be
escaped in order to denote its ASCII encoding <code>0x5C</code>.</li>
</ul>
<h4 id="raw-byte-string-literals"><a class="header" href="#raw-byte-string-literals">Raw byte string literals</a></h4>
<blockquote>
<p><strong><sup>Lexer</sup></strong><br />
RAW_BYTE_STRING_LITERAL :<br />
   <code>br</code> RAW_BYTE_STRING_CONTENT SUFFIX<sup>?</sup></p>
<p>RAW_BYTE_STRING_CONTENT :<br />
      <code>&quot;</code> ASCII<sup>* (non-greedy)</sup> <code>&quot;</code><br />
   | <code>#</code> RAW_BYTE_STRING_CONTENT <code>#</code></p>
<p>ASCII :<br />
   <em>any ASCII (i.e. 0x00 to 0x7F)</em></p>
</blockquote>
<p>Raw byte string literals do not process any escapes. They start with the
character <code>U+0062</code> (<code>b</code>), followed by <code>U+0072</code> (<code>r</code>), followed by fewer than 256
of the character <code>U+0023</code> (<code>#</code>), and a <code>U+0022</code> (double-quote) character. The
<em>raw string body</em> can contain any sequence of ASCII characters and is terminated
only by another <code>U+0022</code> (double-quote) character, followed by the same number of
<code>U+0023</code> (<code>#</code>) characters that preceded the opening <code>U+0022</code> (double-quote)
character. A raw byte string literal can not contain any non-ASCII byte.</p>
<p>All characters contained in the raw string body represent their ASCII encoding,
the characters <code>U+0022</code> (double-quote) (except when followed by at least as
many <code>U+0023</code> (<code>#</code>) characters as were used to start the raw string literal) or
<code>U+005C</code> (<code>\</code>) do not have any special meaning.</p>
<p>Examples for byte string literals:</p>
<pre><code class="language-ds">b&quot;foo&quot;; br&quot;foo&quot;;                     // foo
b&quot;\&quot;foo\&quot;&quot;; br#&quot;&quot;foo&quot;&quot;#;             // &quot;foo&quot;

b&quot;foo #\&quot;# bar&quot;;
br##&quot;foo #&quot;# bar&quot;##;                 // foo #&quot;# bar

b&quot;\x52&quot;; b&quot;R&quot;; br&quot;R&quot;;                // R
b&quot;\\x52&quot;; br&quot;\x52&quot;;                  // \x52
</code></pre>
<h3 id="number-literals"><a class="header" href="#number-literals">Number literals</a></h3>
<p>A <em>number literal</em> is either an <em>integer literal</em> or a <em>floating-point
literal</em>. The grammar for recognizing the two kinds of literals is mixed.</p>
<h4 id="integer-literals"><a class="header" href="#integer-literals">Integer literals</a></h4>
<blockquote>
<p><strong><sup>Lexer</sup></strong><br />
INTEGER_LITERAL :<br />
   ( DEC_LITERAL | BIN_LITERAL | OCT_LITERAL | HEX_LITERAL )
SUFFIX_NO_E<sup>?</sup></p>
<p>DEC_LITERAL :<br />
   DEC_DIGIT (DEC_DIGIT|<code>_</code>)<sup>*</sup></p>
<p>BIN_LITERAL :<br />
   <code>0b</code> (BIN_DIGIT|<code>_</code>)<sup>*</sup> BIN_DIGIT (BIN_DIGIT|<code>_</code>)<sup>*</sup></p>
<p>OCT_LITERAL :<br />
   <code>0o</code> (OCT_DIGIT|<code>_</code>)<sup>*</sup> OCT_DIGIT (OCT_DIGIT|<code>_</code>)<sup>*</sup></p>
<p>HEX_LITERAL :<br />
   <code>0x</code> (HEX_DIGIT|<code>_</code>)<sup>*</sup> HEX_DIGIT (HEX_DIGIT|<code>_</code>)<sup>*</sup></p>
<p>BIN_DIGIT : [<code>0</code>-<code>1</code>]</p>
<p>OCT_DIGIT : [<code>0</code>-<code>7</code>]</p>
<p>DEC_DIGIT : [<code>0</code>-<code>9</code>]</p>
<p>HEX_DIGIT : [<code>0</code>-<code>9</code> <code>a</code>-<code>f</code> <code>A</code>-<code>F</code>]</p>
</blockquote>
<p>An <em>integer literal</em> has one of four forms:</p>
<ul>
<li>A <em>decimal literal</em> starts with a <em>decimal digit</em> and continues with any
mixture of <em>decimal digits</em> and <em>underscores</em>.</li>
<li>A <em>hex literal</em> starts with the character sequence <code>U+0030</code> <code>U+0078</code>
(<code>0x</code>) and continues as any mixture (with at least one digit) of hex digits
and underscores.</li>
<li>An <em>octal literal</em> starts with the character sequence <code>U+0030</code> <code>U+006F</code>
(<code>0o</code>) and continues as any mixture (with at least one digit) of octal digits
and underscores.</li>
<li>A <em>binary literal</em> starts with the character sequence <code>U+0030</code> <code>U+0062</code>
(<code>0b</code>) and continues as any mixture (with at least one digit) of binary digits
and underscores.</li>
</ul>
<p>Like any literal, an integer literal may be followed (immediately, without any spaces) by a suffix as described above.
The suffix may not begin with <code>e</code> or <code>E</code>, as that would be interpreted as the exponent of a floating-point literal.
See <a href="expressions/literal-expr.html">literal expressions</a> for the effect of these suffixes.</p>
<p>Examples of integer literals which are accepted as literal expressions:</p>
<pre><code class="language-ds">123;
123i32;
123u32;
123_u32;

0xff;
0x01_f64; // integer 7986, not floating-point 1.0
0x01_e3;  // integer 483, not floating-point 1000.0

0o70;
0o70_i32;

0b1111_1111_1001_0000;
0b1111_1111_1001_0000i32;
0b________1;

// This is an integer literal, accepted as a floating-point literal expression.
5f64;
</code></pre>
<p>Note that <code>-1i32</code>, for example, is analyzed as two tokens: <code>-</code> followed by <code>1i32</code>.</p>
<p>Examples of integer literals which are not accepted as literal expressions:</p>
<pre><code class="language-ds">0invalidSuffix;
123AFB43;
0b010a;
0xAB_CD_EF_GH;
0b1111_f64;
</code></pre>
<h4 id="tuple-index"><a class="header" href="#tuple-index">Tuple index</a></h4>
<blockquote>
<p><strong><sup>Lexer</sup></strong><br />
TUPLE_INDEX: <br />
   INTEGER_LITERAL</p>
</blockquote>
<p>A tuple index is used to refer to the fields of <a href="types/tuple.html">tuples</a>, <a href="items/structs.html">tuple structs</a>, and
<a href="items/enumerations.html">tuple variants</a>.</p>
<p>Tuple indices are compared with the literal token directly. Tuple indices
start with <code>0</code> and each successive index increments the value by <code>1</code> as a
decimal value. Thus, only decimal values will match, and the value must not
have any extra <code>0</code> prefix characters.</p>
<pre><code class="language-ds compile_fail">let example = (&quot;dog&quot;, &quot;cat&quot;, &quot;horse&quot;);
let dog = example.0;
let cat = example.1;
// The following examples are invalid.
let cat = example.01;  // ERROR no field named `01`
let horse = example.0b10;  // ERROR no field named `0b10`
</code></pre>
<h4 id="floating-point-literals"><a class="header" href="#floating-point-literals">Floating-point literals</a></h4>
<blockquote>
<p><strong><sup>Lexer</sup></strong><br />
FLOAT_LITERAL :<br />
      DEC_LITERAL <code>.</code>
<em>(not immediately followed by <code>.</code>, <code>_</code> or an XID_Start character)</em><br />
   | DEC_LITERAL <code>.</code> DEC_LITERAL SUFFIX_NO_E<sup>?</sup><br />
   | DEC_LITERAL (<code>.</code> DEC_LITERAL)<sup>?</sup> FLOAT_EXPONENT SUFFIX<sup>?</sup></p>
<p>FLOAT_EXPONENT :<br />
   (<code>e</code>|<code>E</code>) (<code>+</code>|<code>-</code>)<sup>?</sup>
(DEC_DIGIT|<code>_</code>)<sup>*</sup> DEC_DIGIT (DEC_DIGIT|<code>_</code>)<sup>*</sup></p>
</blockquote>
<p>A <em>floating-point literal</em> has one of two forms:</p>
<ul>
<li>A <em>decimal literal</em> followed by a period character <code>U+002E</code> (<code>.</code>). This is
optionally followed by another decimal literal, with an optional <em>exponent</em>.</li>
<li>A single <em>decimal literal</em> followed by an <em>exponent</em>.</li>
</ul>
<p>Like integer literals, a floating-point literal may be followed by a
suffix, so long as the pre-suffix part does not end with <code>U+002E</code> (<code>.</code>).
The suffix may not begin with <code>e</code> or <code>E</code> if the literal does not include an exponent.
See <a href="expressions/literal-expr.html">literal expressions</a> for the effect of these suffixes.</p>
<p>Examples of floating-point literals which are accepted as literal expressions:</p>
<pre><code class="language-ds">123.0f64;
0.1f64;
12E+99_f64;
let x: f64 = 2.;
</code></pre>
<p>This last example is different because it is not possible to use the suffix
syntax with a floating point literal ending in a period. <code>2.f64</code> would attempt
to call a method named <code>f64</code> on <code>2</code>.</p>
<p>Note that <code>-1.0</code>, for example, is analyzed as two tokens: <code>-</code> followed by <code>1.0</code>.</p>
<p>Examples of floating-point literals which are not accepted as literal expressions:</p>
<pre><code class="language-ds">2.0f80;
2e5f80;
2e5e6;
2.0e5e6;
1.3e10u32;
</code></pre>
<h4 id="reserved-forms-similar-to-number-literals"><a class="header" href="#reserved-forms-similar-to-number-literals">Reserved forms similar to number literals</a></h4>
<blockquote>
<p><strong><sup>Lexer</sup></strong><br />
RESERVED_NUMBER :<br />
      BIN_LITERAL [<code>2</code>-<code>9</code>​]<br />
   | OCT_LITERAL [<code>8</code>-<code>9</code>​]<br />
   | ( BIN_LITERAL | OCT_LITERAL | HEX_LITERAL ) <code>.</code> <br />
         <em>(not immediately followed by <code>.</code>, <code>_</code> or an XID_Start character)</em><br />
   | ( BIN_LITERAL | OCT_LITERAL ) (<code>e</code>|<code>E</code>)<br />
   | <code>0b</code> <code>_</code><sup>*</sup> <em>end of input or not BIN_DIGIT</em><br />
   | <code>0o</code> <code>_</code><sup>*</sup> <em>end of input or not OCT_DIGIT</em><br />
   | <code>0x</code> <code>_</code><sup>*</sup> <em>end of input or not HEX_DIGIT</em><br />
   | DEC_LITERAL ( . DEC_LITERAL)<sup>?</sup> (<code>e</code>|<code>E</code>) (<code>+</code>|<code>-</code>)<sup>?</sup> <em>end of input or not DEC_DIGIT</em></p>
</blockquote>
<p>The following lexical forms similar to number literals are <em>reserved forms</em>.
Due to the possible ambiguity these raise, they are rejected by the tokenizer instead of being interpreted as separate tokens.</p>
<ul>
<li>
<p>An unsuffixed binary or octal literal followed, without intervening whitespace, by a decimal digit out of the range for its radix.</p>
</li>
<li>
<p>An unsuffixed binary, octal, or hexadecimal literal followed, without intervening whitespace, by a period character (with the same restrictions on what follows the period as for floating-point literals).</p>
</li>
<li>
<p>An unsuffixed binary or octal literal followed, without intervening whitespace, by the character <code>e</code> or <code>E</code>.</p>
</li>
<li>
<p>Input which begins with one of the radix prefixes but is not a valid binary, octal, or hexadecimal literal (because it contains no digits).</p>
</li>
<li>
<p>Input which has the form of a floating-point literal with no digits in the exponent.</p>
</li>
</ul>
<p>Examples of reserved forms:</p>
<pre><code class="language-ds compile_fail">0b0102;  // this is not `0b010` followed by `2`
0o1279;  // this is not `0o127` followed by `9`
0x80.0;  // this is not `0x80` followed by `.` and `0`
0b101e;  // this is not a suffixed literal, or `0b101` followed by `e`
0b;      // this is not an integer literal, or `0` followed by `b`
0b_;     // this is not an integer literal, or `0` followed by `b_`
2e;      // this is not a floating-point literal, or `2` followed by `e`
2.0e;    // this is not a floating-point literal, or `2.0` followed by `e`
2em;     // this is not a suffixed literal, or `2` followed by `em`
2.0em;   // this is not a suffixed literal, or `2.0` followed by `em`
</code></pre>
<h2 id="loop-labels"><a class="header" href="#loop-labels">Loop labels</a></h2>
<blockquote>
<p><strong><sup>Lexer</sup></strong><br />
LABEL_TOKEN :<br />
      <code>'</code> <a href="identifiers.html">NON_KEYWORD_IDENTIFIER</a></p>
</blockquote>
<p><a href="expressions/loop-expr.html">Loop labels</a> use LABEL_TOKEN tokens. Any
LABEL_TOKEN will be accepted by the lexer, and for example, can be used in
macros.</p>
<h2 id="punctuation"><a class="header" href="#punctuation">Punctuation</a></h2>
<p>Punctuation symbol tokens are listed here for completeness. Their individual
usages and meanings are defined in the linked pages.</p>
<div class="table-wrapper"><table><thead><tr><th>Symbol</th><th>Name</th><th>Usage</th></tr></thead><tbody>
<tr><td><code>+</code></td><td>Plus</td><td><a href="expressions/operator-expr.html#arithmetic-and-logical-binary-operators">Addition</a>, <a href="trait-bounds.html">Trait Bounds</a>, <a href="macros-by-example.html">Macro Kleene Matcher</a></td></tr>
<tr><td><code>-</code></td><td>Minus</td><td><a href="expressions/operator-expr.html#arithmetic-and-logical-binary-operators">Subtraction</a>, <a href="expressions/operator-expr.html#negation-operators">Negation</a></td></tr>
<tr><td><code>*</code></td><td>Star</td><td><a href="expressions/operator-expr.html#arithmetic-and-logical-binary-operators">Multiplication</a>, <a href="macros-by-example.html">Macro Kleene Matcher</a>, <a href="items/use-declarations.html">Use wildcards</a></td></tr>
<tr><td><code>/</code></td><td>Slash</td><td><a href="expressions/operator-expr.html#arithmetic-and-logical-binary-operators">Division</a></td></tr>
<tr><td><code>%</code></td><td>Percent</td><td><a href="expressions/operator-expr.html#arithmetic-and-logical-binary-operators">Remainder</a></td></tr>
<tr><td><code>^</code></td><td>Caret</td><td><a href="expressions/operator-expr.html#arithmetic-and-logical-binary-operators">Bitwise and Logical XOR</a></td></tr>
<tr><td><code>!</code></td><td>Not</td><td><a href="expressions/operator-expr.html#negation-operators">Bitwise and Logical NOT</a>, <a href="macros-by-example.html">Macro Calls</a>, <a href="attributes.html">Inner Attributes</a>, <a href="types/never.html">Never Type</a>, <a href="items/implementations.html">Negative impls</a></td></tr>
<tr><td><code>&amp;</code></td><td>And</td><td><a href="expressions/operator-expr.html#arithmetic-and-logical-binary-operators">Bitwise and Logical AND</a>, [Borrow], <a href="types/pointer.html">References</a>, <a href="patterns.html#reference-patterns">Reference patterns</a></td></tr>
<tr><td><code>|</code></td><td>Or</td><td><a href="expressions/operator-expr.html#arithmetic-and-logical-binary-operators">Bitwise and Logical OR</a>, <a href="expressions/closure-expr.html">Closures</a>, Patterns in <a href="expressions/match-expr.html">match</a>, <a href="expressions/if-expr.html#if-let-expressions">if let</a>, and <a href="expressions/loop-expr.html#predicate-pattern-loops">while let</a></td></tr>
<tr><td><code>&amp;&amp;</code></td><td>AndAnd</td><td><a href="expressions/operator-expr.html#lazy-boolean-operators">Lazy AND</a>, [Borrow], <a href="types/pointer.html">References</a>, <a href="patterns.html#reference-patterns">Reference patterns</a></td></tr>
<tr><td><code>||</code></td><td>OrOr</td><td><a href="expressions/operator-expr.html#lazy-boolean-operators">Lazy OR</a>, <a href="expressions/closure-expr.html">Closures</a></td></tr>
<tr><td><code>&lt;&lt;</code></td><td>Shl</td><td><a href="expressions/operator-expr.html#arithmetic-and-logical-binary-operators">Shift Left</a>, <a href="items/generics.html">Nested Generics</a></td></tr>
<tr><td><code>&gt;&gt;</code></td><td>Shr</td><td><a href="expressions/operator-expr.html#arithmetic-and-logical-binary-operators">Shift Right</a>, <a href="items/generics.html">Nested Generics</a></td></tr>
<tr><td><code>+=</code></td><td>PlusEq</td><td><a href="expressions/operator-expr.html#compound-assignment-expressions">Addition assignment</a></td></tr>
<tr><td><code>-=</code></td><td>MinusEq</td><td><a href="expressions/operator-expr.html#compound-assignment-expressions">Subtraction assignment</a></td></tr>
<tr><td><code>*=</code></td><td>StarEq</td><td><a href="expressions/operator-expr.html#compound-assignment-expressions">Multiplication assignment</a></td></tr>
<tr><td><code>/=</code></td><td>SlashEq</td><td><a href="expressions/operator-expr.html#compound-assignment-expressions">Division assignment</a></td></tr>
<tr><td><code>%=</code></td><td>PercentEq</td><td><a href="expressions/operator-expr.html#compound-assignment-expressions">Remainder assignment</a></td></tr>
<tr><td><code>^=</code></td><td>CaretEq</td><td><a href="expressions/operator-expr.html#compound-assignment-expressions">Bitwise XOR assignment</a></td></tr>
<tr><td><code>&amp;=</code></td><td>AndEq</td><td><a href="expressions/operator-expr.html#compound-assignment-expressions">Bitwise And assignment</a></td></tr>
<tr><td><code>|=</code></td><td>OrEq</td><td><a href="expressions/operator-expr.html#compound-assignment-expressions">Bitwise Or assignment</a></td></tr>
<tr><td><code>&lt;&lt;=</code></td><td>ShlEq</td><td><a href="expressions/operator-expr.html#compound-assignment-expressions">Shift Left assignment</a></td></tr>
<tr><td><code>&gt;&gt;=</code></td><td>ShrEq</td><td><a href="expressions/operator-expr.html#compound-assignment-expressions">Shift Right assignment</a>, <a href="items/generics.html">Nested Generics</a></td></tr>
<tr><td><code>=</code></td><td>Eq</td><td><a href="expressions/operator-expr.html#assignment-expressions">Assignment</a>, <a href="attributes.html">Attributes</a>, Various type definitions</td></tr>
<tr><td><code>==</code></td><td>EqEq</td><td><a href="expressions/operator-expr.html#comparison-operators">Equal</a></td></tr>
<tr><td><code>!=</code></td><td>Ne</td><td><a href="expressions/operator-expr.html#comparison-operators">Not Equal</a></td></tr>
<tr><td><code>&gt;</code></td><td>Gt</td><td><a href="expressions/operator-expr.html#comparison-operators">Greater than</a>, <a href="items/generics.html">Generics</a>, <a href="paths.html">Paths</a></td></tr>
<tr><td><code>&lt;</code></td><td>Lt</td><td><a href="expressions/operator-expr.html#comparison-operators">Less than</a>, <a href="items/generics.html">Generics</a>, <a href="paths.html">Paths</a></td></tr>
<tr><td><code>&gt;=</code></td><td>Ge</td><td><a href="expressions/operator-expr.html#comparison-operators">Greater than or equal to</a>, <a href="items/generics.html">Generics</a></td></tr>
<tr><td><code>&lt;=</code></td><td>Le</td><td><a href="expressions/operator-expr.html#comparison-operators">Less than or equal to</a></td></tr>
<tr><td><code>@</code></td><td>At</td><td><a href="patterns.html#identifier-patterns">Subpattern binding</a></td></tr>
<tr><td><code>_</code></td><td>Underscore</td><td><a href="patterns.html#wildcard-pattern">Wildcard patterns</a>, <a href="types/inferred.html">Inferred types</a>, Unnamed items in <a href="items/constant-items.html">constants</a>, <a href="items/use-declarations.html">use declarations</a>, and <a href="expressions/underscore-expr.html">destructuring assignment</a></td></tr>
<tr><td><code>.</code></td><td>Dot</td><td><a href="expressions/field-expr.html">Field access</a>, <a href="expressions/tuple-expr.html#tuple-indexing-expressions">Tuple index</a></td></tr>
<tr><td><code>..</code></td><td>DotDot</td><td><a href="expressions/range-expr.html">Range</a>, <a href="expressions/struct-expr.html">Struct expressions</a>, <a href="patterns.html">Patterns</a>, <a href="patterns.html#range-patterns">Range Patterns</a></td></tr>
<tr><td><code>...</code></td><td>DotDotDot</td><td>Variadic functions, <a href="patterns.html#range-patterns">Range patterns</a>, array initializer spread</td></tr>
<tr><td><code>..=</code></td><td>DotDotEq</td><td><a href="expressions/range-expr.html">Inclusive Range</a>, <a href="patterns.html#range-patterns">Range patterns</a></td></tr>
<tr><td><code>,</code></td><td>Comma</td><td>Various separators</td></tr>
<tr><td><code>;</code></td><td>Semi</td><td>Terminator for various items and statements, <a href="types/array.html">Array types</a></td></tr>
<tr><td><code>:</code></td><td>Colon</td><td>Various separators</td></tr>
<tr><td><code>::</code></td><td>PathSep</td><td><a href="paths.html">Path separator</a></td></tr>
<tr><td><code>-&gt;</code></td><td>RArrow</td><td><a href="items/functions.html">Function return type</a>, <a href="expressions/closure-expr.html">Closure return type</a>, <a href="types/function.html">Function type</a></td></tr>
<tr><td><code>=&gt;</code></td><td>FatArrow</td><td><a href="expressions/match-expr.html">Match arms</a>, <a href="macros-by-example.html">Macros</a></td></tr>
<tr><td><code>#</code></td><td>Pound</td><td><a href="attributes.html">Attributes</a></td></tr>
<tr><td><code>$</code></td><td>Dollar</td><td><a href="macros-by-example.html">Macros</a></td></tr>
<tr><td><code>?</code></td><td>Question</td><td><a href="expressions/operator-expr.html#the-question-mark-operator">Question mark operator</a>, <a href="macros-by-example.html">Macro Kleene Matcher</a></td></tr>
<tr><td><code>~</code></td><td>Tilde</td><td>The tilde operator is unused</td></tr>
</tbody></table>
</div>
<h2 id="delimiters"><a class="header" href="#delimiters">Delimiters</a></h2>
<p>Bracket punctuation is used in various parts of the grammar. An open bracket
must always be paired with a close bracket. Brackets and the tokens within
them are referred to as &quot;token trees&quot; in <a href="macros-by-example.html">macros</a>.  The three types of brackets are:</p>
<div class="table-wrapper"><table><thead><tr><th>Bracket</th><th>Type</th></tr></thead><tbody>
<tr><td><code>{</code> <code>}</code></td><td>Curly braces</td></tr>
<tr><td><code>[</code> <code>]</code></td><td>Square brackets</td></tr>
<tr><td><code>(</code> <code>)</code></td><td>Parentheses</td></tr>
</tbody></table>
</div>
<h2 id="reserved-prefixes"><a class="header" href="#reserved-prefixes">Reserved prefixes</a></h2>
<blockquote>
<p><strong><sup>Lexer 2021+</sup></strong><br />
RESERVED_TOKEN_DOUBLE_QUOTE : ( IDENTIFIER_OR_KEYWORD <sub><em>Except <code>b</code> or <code>r</code> or <code>br</code></em></sub> | <code>_</code> ) <code>&quot;</code><br />
RESERVED_TOKEN_SINGLE_QUOTE : ( IDENTIFIER_OR_KEYWORD <sub><em>Except <code>b</code></em></sub> | <code>_</code> ) <code>'</code><br />
RESERVED_TOKEN_POUND : ( IDENTIFIER_OR_KEYWORD <sub><em>Except <code>r</code> or <code>br</code></em></sub> | <code>_</code> ) <code>#</code></p>
</blockquote>
<p>Some lexical forms known as <em>reserved prefixes</em> are reserved for future use.</p>
<p>Source input which would otherwise be lexically interpreted as a non-raw identifier (or a keyword or <code>_</code>) which is immediately followed by a <code>#</code>, <code>'</code>, or <code>&quot;</code> character (without intervening whitespace) is identified as a reserved prefix.</p>
<p>Note that raw identifiers, raw string literals, and raw byte string literals may contain a <code>#</code> character but are not interpreted as containing a reserved prefix.</p>
<p>Similarly the <code>r</code>, <code>b</code>, and <code>br</code> prefixes used in raw string literals, byte literals, byte string literals, and raw byte string literals are not interpreted as reserved prefixes.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="macros"><a class="header" href="#macros">Macros</a></h1>
<p>The functionality and syntax of DS can be extended with custom definitions
called macros. They are given names, and invoked through a consistent
syntax: <code>some_extension!(...)</code>.</p>
<p>There are two ways to define new macros:</p>
<ul>
<li><a href="macros-by-example.html">Macros by Example</a> define new syntax in a higher-level, declarative way.</li>
<li><a href="procedural-macros.html">Procedural Macros</a> define function-like macros, custom derives, and custom
attributes using functions that operate on input tokens.</li>
</ul>
<h2 id="macro-invocation"><a class="header" href="#macro-invocation">Macro Invocation</a></h2>
<blockquote>
<p><strong><sup>Syntax</sup></strong><br />
<em>MacroInvocation</em> :<br />
       <a href="paths.html#simple-paths"><em>SimplePath</em></a> <code>!</code> <em>DelimTokenTree</em><br />
   | <a href="expressions.html"><em>Expression</em></a> <code>.</code> <a href="identifiers.html">IDENTIFIER</a> <code>!</code> <em>DelimTokenTree</em></p>
<p><em>DelimTokenTree</em> :<br />
       <code>(</code> <em>TokenTree</em><sup>*</sup> <code>)</code><br />
   | <code>[</code> <em>TokenTree</em><sup>*</sup> <code>]</code><br />
   | <code>{</code> <em>TokenTree</em><sup>*</sup> <code>}</code></p>
<p><em>TokenTree</em> :<br />
   <a href="tokens.html"><em>Token</em></a><sub><em>except <a href="tokens.html#delimiters">delimiters</a></em></sub> | <em>DelimTokenTree</em></p>
<p><em>MacroInvocationSemi</em> :<br />
      <a href="paths.html#simple-paths"><em>SimplePath</em></a> <code>!</code> <code>(</code> <em>TokenTree</em><sup>*</sup> <code>)</code> <code>;</code><br />
   | <a href="paths.html#simple-paths"><em>SimplePath</em></a> <code>!</code> <code>[</code> <em>TokenTree</em><sup>*</sup> <code>]</code> <code>;</code><br />
   | <a href="paths.html#simple-paths"><em>SimplePath</em></a> <code>!</code> <code>{</code> <em>TokenTree</em><sup>*</sup> <code>}</code></p>
</blockquote>
<p>A macro invocation expands a macro at compile time and replaces the
invocation with the result of the macro. Macros may be invoked in the
following situations:</p>
<ul>
<li><a href="expressions.html">Expressions</a> and <a href="statements.html">statements</a></li>
<li><a href="patterns.html">Patterns</a></li>
<li><a href="types.html">Types</a></li>
<li><a href="items.html">Items</a> including <a href="items/associated-items.html">associated items</a></li>
<li><a href="macros-by-example.html">Macros by Example</a> transcribers</li>
<li><a href="items/external-blocks.html">External blocks</a></li>
</ul>
<p>When used as an item or a statement, the <em>MacroInvocationSemi</em> form is used
where a semicolon is required at the end when not using curly braces.
<a href="visibility-and-privacy.html">Visibility qualifiers</a> are never allowed before a macro invocation or
<a href="macros-by-example.html">Macros by Example</a> definition.</p>
<pre><code class="language-ds">// Used as an expression.
let x = f!(10);

// Used as a method.
o.f!();

// Used as a statement.
print!(&quot;Hello!&quot;);

// Used in a pattern.
macro pat {
    ($i:ident) =&gt; (Some($i)),
}

if let pat!(x) = Some(1) {
    assert_eq!(x, 1);
}

// Used in a type.
macro Tuple {
    { $A:ty, $B:ty } =&gt; { ($A, $B) },
}

type N2 = Tuple!(i32, i32);

// Used as an item.
my_custom_item_macro!(static FOO: T = v);

// Used as an associated item.
macro const_maker {
    ($t:ty, $v:tt) =&gt; { const CONST: $t = $v; },
}
trait T {
    const_maker!{i32, 7}
}

// Macro calls within macros.
macro example {
    () =&gt; { print!(&quot;Macro call in a macro!&quot;) },
}
// Outer macro `example` is expanded, then inner macro `print` is expanded.
example!();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="macros-by-example"><a class="header" href="#macros-by-example">Macros By Example</a></h1>
<blockquote>
<p><strong><sup>Syntax</sup></strong><br />
<em>MacroRulesDefinition</em> :<br />
   <code>macro</code> <a href="identifiers.html">IDENTIFIER</a> <em>MacroRulesDef</em></p>
<p><em>MacroRulesDef</em> :<br />
      <em>MacroMatcher</em> <code>{</code> <em>MacroTranscriber</em> <code>}</code> <br />
   | <code>{</code> <em>MacroRules</em> <code>}</code></p>
<p><em>MacroRules</em> :<br />
   <em>MacroRule</em> ( <code>,</code> <em>MacroRule</em> )<sup>*</sup> <code>,</code><sup>?</sup></p>
<p><em>MacroRule</em> :<br />
   <em>MacroMatcher</em> <code>=&gt;</code> <em>MacroTranscriber</em></p>
<p><em>MacroMatcher</em> :<br />
      <code>(</code> <em>MacroMatch</em><sup>*</sup> <code>)</code><br />
   | <code>[</code> <em>MacroMatch</em><sup>*</sup> <code>]</code><br />
   | <code>{</code> <em>MacroMatch</em><sup>*</sup> <code>}</code></p>
<p><em>MacroMatch</em> :<br />
      <a href="tokens.html"><em>Token</em></a><sub><em>except <code>$</code> and <a href="tokens.html#delimiters">delimiters</a></em></sub><br />
   | <em>MacroMatcher</em><br />
   | <code>$</code> ( <a href="identifiers.html">IDENTIFIER_OR_KEYWORD</a> <sub><em>except <code>crate</code></em></sub> | <a href="identifiers.html">RAW_IDENTIFIER</a> | <code>_</code> ) <code>:</code> <em>MacroFragSpec</em><br />
   | <code>$</code> <code>(</code> <em>MacroMatch</em><sup>+</sup> <code>)</code> <em>MacroRepSep</em><sup>?</sup> <em>MacroRepOp</em></p>
<p><em>MacroFragSpec</em> :<br />
      <code>block</code> | <code>expr</code> | <code>ident</code> | <code>item</code> | <code>label</code> | <code>literal</code><br />
   | <code>meta</code> | <code>pat</code> | <code>pat_param</code> | <code>path</code> | <code>stmt</code> | <code>tt</code> | <code>ty</code> | <code>vis</code></p>
<p><em>MacroRepSep</em> :<br />
   <a href="tokens.html"><em>Token</em></a><sub><em>except <a href="tokens.html#delimiters">delimiters</a> and MacroRepOp</em></sub></p>
<p><em>MacroRepOp</em> :<br />
   <code>*</code> | <code>+</code> | <code>?</code></p>
<p><em>MacroTranscriber</em> :<br />
   <a href="macros.html"><em>DelimTokenTree</em></a></p>
</blockquote>
<p><code>macro</code> allows users to define syntax extension in a declarative way.  We
call such extensions &quot;macros by example&quot; or simply &quot;macros&quot;.</p>
<p>Each macro by example has a name, and one or more <em>rules</em>. Each rule has two
parts: a <em>matcher</em>, describing the syntax that it matches, and a <em>transcriber</em>,
describing the syntax that will replace a successfully matched invocation. Both
the matcher and the transcriber must be surrounded by delimiters. Macros can
expand to expressions, statements, items (including traits, impls, and foreign
items), types, or patterns.</p>
<h2 id="method-macro"><a class="header" href="#method-macro">Method macro</a></h2>
<p>Macros that appear within a trait or implementation are method macros. Method macros have a <code>__self</code> metavariable available, which is the instance they are called with.</p>
<pre><code class="language-ds">impl S {
    pub macro f() {
        __self.f2();
    }
}
</code></pre>
<h2 id="transcribing"><a class="header" href="#transcribing">Transcribing</a></h2>
<p>When a macro is invoked, the macro expander looks up macro invocations by name,
and tries each macro rule in turn. It transcribes the first successful match; if
this results in an error, then future matches are not tried. When matching, no
lookahead is performed; if the compiler cannot unambiguously determine how to
parse the macro invocation one token at a time, then it is an error. In the
following example, the compiler does not look ahead past the identifier to see
if the following token is a <code>)</code>, even though that would allow it to parse the
invocation unambiguously:</p>
<pre><code class="language-ds">macro ambiguity {
    ($($i:ident)* $j:ident) =&gt; { },
}

ambiguity!(error); // Error: local ambiguity
</code></pre>
<p>In both the matcher and the transcriber, the <code>$</code> token is used to invoke special
behaviours from the macro engine (described below in <a href="macros-by-example.html#metavariables">Metavariables</a> and
<a href="macros-by-example.html#repetitions">Repetitions</a>). Tokens that aren't part of such an invocation are matched and
transcribed literally, with one exception. The exception is that the outer
delimiters for the matcher will match any pair of delimiters. Thus, for
instance, the matcher <code>(())</code> will match <code>{()}</code> but not <code>{{}}</code>. The character
<code>$</code> cannot be matched or transcribed literally.</p>
<h3 id="forwarding-a-matched-fragment"><a class="header" href="#forwarding-a-matched-fragment">Forwarding a matched fragment</a></h3>
<p>When forwarding a matched fragment to another macro-by-example, matchers in
the second macro will see an opaque AST of the fragment type. The second macro
can't use literal tokens to match the fragments in the matcher, only a
fragment specifier of the same type. The <code>ident</code>, <code>label</code>, and <code>tt</code>
fragment types are an exception, and <em>can</em> be matched by literal tokens. The
following illustrates this restriction:</p>
<pre><code class="language-ds">macro foo {
    ($l:expr) =&gt; { bar!($l); }
// ERROR:               ^^ no rules expected this token in macro call
}

macro bar {
    (3) =&gt; {}
}

foo!(3);
</code></pre>
<p>The following illustrates how tokens can be directly matched after matching a
<code>tt</code> fragment:</p>
<pre><code class="language-ds">// compiles OK
macro foo {
    ($l:tt) =&gt; { bar!($l); },
}

macro bar {
    (3) =&gt; {}
}

foo!(3);
</code></pre>
<h2 id="metavariables"><a class="header" href="#metavariables">Metavariables</a></h2>
<p>In the matcher, <code>$</code> <em>name</em> <code>:</code> <em>fragment-specifier</em> matches a DS syntax
fragment of the kind specified and binds it to the metavariable <code>$</code><em>name</em>. Valid
fragment specifiers are:</p>
<ul>
<li><code>item</code>: an <a href="items.html"><em>Item</em></a></li>
<li><code>block</code>: a <a href="expressions/block-expr.html"><em>BlockExpression</em></a></li>
<li><code>stmt</code>: a <a href="statements.html"><em>Statement</em></a> without the trailing semicolon (except for item
statements that require semicolons)</li>
<li><code>pat_param</code>: a <a href="patterns.html"><em>PatternNoTopAlt</em></a></li>
<li><code>pat</code>: at least any <a href="patterns.html"><em>PatternNoTopAlt</em></a>, and possibly more depending on edition</li>
<li><code>expr</code>: an <a href="expressions.html"><em>Expression</em></a></li>
<li><code>ty</code>: a <a href="types.html#type-expressions"><em>Type</em></a></li>
<li><code>ident</code>: an <a href="identifiers.html">IDENTIFIER_OR_KEYWORD</a> or <a href="identifiers.html">RAW_IDENTIFIER</a></li>
<li><code>path</code>: a <a href="paths.html#paths-in-types"><em>TypePath</em></a> style path</li>
<li><code>tt</code>: a <a href="macros.html#macro-invocation"><em>TokenTree</em></a> (a single <a href="tokens.html">token</a> or tokens in matching delimiters <code>()</code>, <code>[]</code>, or <code>{}</code>)</li>
<li><code>meta</code>: an <a href="attributes.html"><em>Attr</em></a>, the contents of an attribute</li>
<li><code>label</code>: a <a href="tokens.html#loop-labels">LABEL_TOKEN</a></li>
<li><code>vis</code>: a possibly empty <a href="visibility-and-privacy.html"><em>Visibility</em></a> qualifier</li>
<li><code>literal</code>: matches <code>-</code><sup>?</sup><a href="expressions/literal-expr.html"><em>LiteralExpression</em></a></li>
</ul>
<p>In the transcriber, metavariables are referred to simply by <code>$</code><em>name</em>, since
the fragment kind is specified in the matcher. Metavariables are replaced with
the syntax element that matched them. The keyword metavariable <code>$crate</code> can be
used to refer to the current crate; see <a href="macros-by-example.html#hygiene">Hygiene</a> below. Metavariables can be
transcribed more than once or not at all.</p>
<h2 id="repetitions"><a class="header" href="#repetitions">Repetitions</a></h2>
<p>In both the matcher and transcriber, repetitions are indicated by placing the
tokens to be repeated inside <code>$(</code>…<code>)</code>, followed by a repetition operator,
optionally with a separator token between. The separator token can be any token
other than a delimiter or one of the repetition operators, but <code>;</code> and <code>,</code> are
the most common. For instance, <code>$( $i:ident ),*</code> represents any number of
identifiers separated by commas. Nested repetitions are permitted.</p>
<p>The repetition operators are:</p>
<ul>
<li><code>*</code> — indicates any number of repetitions.</li>
<li><code>+</code> — indicates any number but at least one.</li>
<li><code>?</code> — indicates an optional fragment with zero or one occurrence.</li>
</ul>
<p>Since <code>?</code> represents at most one occurrence, it cannot be used with a
separator.</p>
<p>The repeated fragment both matches and transcribes to the specified number of
the fragment, separated by the separator token. Metavariables are matched to
every repetition of their corresponding fragment. For instance, the <code>$( $i:ident ),*</code> example above matches <code>$i</code> to all of the identifiers in the list.</p>
<p>During transcription, additional restrictions apply to repetitions so that the
compiler knows how to expand them properly:</p>
<ol>
<li>A metavariable must appear in exactly the same number, kind, and nesting
order of repetitions in the transcriber as it did in the matcher. So for the
matcher <code>$( $i:ident ),*</code>, the transcribers <code>=&gt; { $i }</code>,
<code>=&gt; { $( $( $i)* )* }</code>, and <code>=&gt; { $( $i )+ }</code> are all illegal, but
<code>=&gt; { $( $i );* }</code> is correct and replaces a comma-separated list of
identifiers with a semicolon-separated list.</li>
<li>Each repetition in the transcriber must contain at least one metavariable to
decide how many times to expand it. If multiple metavariables appear in the
same repetition, they must be bound to the same number of fragments. For
instance, <code>( $( $i:ident ),* ; $( $j:ident ),* ) =&gt; (( $( ($i,$j) ),* ))</code> must
bind the same number of <code>$i</code> fragments as <code>$j</code> fragments. This means that
invoking the macro with <code>(a, b, c; d, e, f)</code> is legal and expands to
<code>((a,d), (b,e), (c,f))</code>, but <code>(a, b, c; d, e)</code> is illegal because it does
not have the same number. This requirement applies to every layer of nested
repetitions.</li>
</ol>
<h2 id="hygiene"><a class="header" href="#hygiene">Hygiene</a></h2>
<p>By default, all identifiers referred to in a macro are expanded as-is, and are
looked up at the macro's invocation site. This can lead to issues if a macro
refers to an item or macro which isn't in scope at the invocation site. To
alleviate this, the <code>$crate</code> metavariable can be used at the start of a path to
force lookup to occur inside the crate defining the macro.</p>
<pre><code class="language-ds">//// Definitions in the `helper_macro` crate.
pub macro helped {
    // () =&gt; { helper!() } // This might lead to an error due to 'helper' not being in scope.
    () =&gt; { $crate::helper!() }
}

pub macro helper {
    () =&gt; { () }
}

//// Usage in another crate.
// Note that `helper_macro::helper` is not imported!
use helper_macro::helped;

fn unit() {
    helped!();
}
</code></pre>
<p>Note that, because <code>$crate</code> refers to the current crate, it must be used with a
fully qualified module path when referring to non-macro items:</p>
<pre><code class="language-ds">pub mod inner {
    pub macro call_foo {
        () =&gt; { $crate::inner::foo() };
    }

    pub fn foo() {}
}
</code></pre>
<p>Additionally, even though <code>$crate</code> allows a macro to refer to items within its
own crate when expanding, its use has no effect on visibility. An item or macro
referred to must still be visible from the invocation site. In the following
example, any attempt to invoke <code>call_foo!()</code> from outside its crate will fail
because <code>foo()</code> is not public.</p>
<pre><code class="language-ds">pub macro call_foo {
    () =&gt; { $crate::foo() };
}

fn foo() {}
</code></pre>
<h2 id="follow-set-ambiguity-restrictions"><a class="header" href="#follow-set-ambiguity-restrictions">Follow-set Ambiguity Restrictions</a></h2>
<p>The parser used by the macro system is reasonably powerful, but it is limited in
order to prevent ambiguity in current or future versions of the language. In
particular, in addition to the rule about ambiguous expansions, a nonterminal
matched by a metavariable must be followed by a token which has been decided can
be safely used after that kind of match.</p>
<p>As an example, a macro matcher like <code>$i:expr [ , ]</code> could in theory be accepted
in DS today, since <code>[,]</code> cannot be part of a legal expression and therefore
the parse would always be unambiguous. However, because <code>[</code> can start trailing
expressions, <code>[</code> is not a character which can safely be ruled out as coming
after an expression. If <code>[,]</code> were accepted in a later version of DS, this
matcher would become ambiguous or would misparse, breaking working code.
Matchers like <code>$i:expr,</code> or <code>$i:expr;</code> would be legal, however, because <code>,</code> and
<code>;</code> are legal expression separators. The specific rules are:</p>
<ul>
<li><code>expr</code> and <code>stmt</code> may only be followed by one of: <code>=&gt;</code>, <code>,</code>, or <code>;</code>.</li>
<li><code>pat_param</code> may only be followed by one of: <code>=&gt;</code>, <code>,</code>, <code>=</code>, <code>|</code>, <code>if</code>, or <code>in</code>.</li>
<li><code>pat</code> may only be followed by one of: <code>=&gt;</code>, <code>,</code>, <code>=</code>, <code>if</code>, or <code>in</code>.</li>
<li><code>path</code> and <code>ty</code> may only be followed by one of: <code>=&gt;</code>, <code>,</code>, <code>=</code>, <code>|</code>, <code>;</code>,
<code>:</code>, <code>&gt;</code>, <code>&gt;&gt;</code>, <code>[</code>, <code>{</code>, <code>as</code>, <code>where</code>, or a macro variable of <code>block</code>
fragment specifier.</li>
<li><code>vis</code> may only be followed by one of: <code>,</code>, an identifier other than a
non-raw <code>priv</code>, any token that can begin a type, or a metavariable with a
<code>ident</code>, <code>ty</code>, or <code>path</code> fragment specifier.</li>
<li>All other fragment specifiers have no restrictions.</li>
</ul>
<p>When repetitions are involved, then the rules apply to every possible number of
expansions, taking separators into account. This means:</p>
<ul>
<li>If the repetition includes a separator, that separator must be able to
follow the contents of the repetition.</li>
<li>If the repetition can repeat multiple times (<code>*</code> or <code>+</code>), then the contents
must be able to follow themselves.</li>
<li>The contents of the repetition must be able to follow whatever comes
before, and whatever comes after must be able to follow the contents of the
repetition.</li>
<li>If the repetition can match zero times (<code>*</code> or <code>?</code>), then whatever comes
after must be able to follow whatever comes before.</li>
</ul>
<p>For more detail, see the <a href="macro-ambiguity.html">formal specification</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="procedural-macros"><a class="header" href="#procedural-macros">Procedural Macros</a></h2>
<p><em>Procedural macros</em> allow creating syntax extensions as execution of a function.
Procedural macros come in one of three flavors:</p>
<ul>
<li><a href="procedural-macros.html#function-like-procedural-macros">Function-like macros</a> - <code>custom!(...)</code></li>
<li><a href="procedural-macros.html#derive-macros">Derive macros</a> - <code>#[derive(CustomDerive)]</code></li>
<li><a href="procedural-macros.html#attribute-macros">Attribute macros</a> - <code>#[custom_attribute]</code></li>
</ul>
<p>Procedural macros allow you to run code at compile time that operates over Rust
syntax, both consuming and producing Rust syntax. You can sort of think of
procedural macros as functions from an AST to another AST.</p>
<p>Procedural macros are implemented as separate processes written in the Rust language.</p>
<p>As functions, they must either return syntax, panic, or loop endlessly. Returned
syntax either replaces or adds the syntax depending on the kind of procedural
macro. Panics are caught by the compiler and are turned into a compiler error.
Endless loops are not caught by the compiler which hangs the compiler.</p>
<p>Procedural macros run during compilation, and thus have the same resources that
the compiler has. For example, standard input, error, and output are the same
that the compiler has access to. Similarly, file access is the same.</p>
<p>Procedural macros have two ways of reporting errors. The first is to panic. The
second is to emit a <code>compile_error</code> macro invocation.</p>
<h3 id="the-ds_proc_macro-crate-for-rust"><a class="header" href="#the-ds_proc_macro-crate-for-rust">The <code>ds_proc_macro</code> crate for Rust</a></h3>
<p>Procedural macros are written in Rust by depending on the crate <code>ds_proc_macro</code>. The entry point for the Rust project is as follows:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use ds_proc_macro::{TokenStream, proc_macros};

proc_macros! {
    #[proc_macro]
    fn my_function_macro(input: TokenStream) -&gt; TokenStream {
        output
    }

    #[proc_macro_attribute]
    fn my_attribute_macro(attribute: TokenStream, item: TokenStream) -&gt; TokenStream {
        output
    }

    #[proc_macro_derive]
    fn my_derive_macro(item_input: TokenStream) -&gt; TokenStream {
        // `output` is appended to module or block that the item is in.
        output
    }
}
<span class="boring">}</span></code></pre></pre>
<p>This crate primarily contains a <a href="../proc_macro/struct.TokenStream.html"><code>TokenStream</code></a> type. Procedural macros operate
over <em>token streams</em> instead of AST nodes, which is a far more stable interface
over time for both the compiler and for procedural macros to target. A
<em>token stream</em> is roughly equivalent to <code>Vec&lt;TokenTree&gt;</code> where a <code>TokenTree</code>
can roughly be thought of as lexical token. For example <code>foo</code> is an <code>Ident</code>
token, <code>.</code> is a <code>Punct</code> token, and <code>1.2</code> is a <code>Literal</code> token. The <code>TokenStream</code>
type, unlike <code>Vec&lt;TokenTree&gt;</code>, is cheap to clone.</p>
<p>All tokens have an associated <code>Span</code>. A <code>Span</code> is an opaque value that cannot
be modified but can be manufactured. <code>Span</code>s represent an extent of source
code within a program and are primarily used for error reporting. While you
cannot modify a <code>Span</code> itself, you can always change the <code>Span</code> <em>associated</em>
with any token, such as through getting a <code>Span</code> from another token.</p>
<h3 id="procedural-macro-hygiene"><a class="header" href="#procedural-macro-hygiene">Procedural macro hygiene</a></h3>
<p>Procedural macros are <em>unhygienic</em>. This means they behave as if the output
token stream was simply written inline to the code it's next to. This means that
it's affected by external items and also affects external imports.</p>
<p>Macro authors need to be careful to ensure their macros work in as many contexts
as possible given this limitation. This often includes using absolute paths to
items in libraries (for example, <code>::ds::option::Option</code> instead of <code>Option</code>) or
by ensuring that generated functions have names that are unlikely to clash with
other functions (like <code>__internal_foo</code> instead of <code>foo</code>).</p>
<h3 id="the-proc_macros-section"><a class="header" href="#the-proc_macros-section">The <code>proc_macros!</code> section</a></h3>
<p>A series of procedural macros are defined within the <code>proc_macros!</code> macro. It refers to a Rust project by indicating its path relative to the current source's parent directory:</p>
<pre><code class="language-ds">proc_macros! {
    lang = &quot;rust&quot;;
    path = &quot;./my_proc_macros&quot;;

    // procedural macros here...
}
</code></pre>
<h3 id="function-like-procedural-macros"><a class="header" href="#function-like-procedural-macros">Function-like procedural macros</a></h3>
<p><em>Function-like procedural macros</em> are procedural macros that are invoked using
the macro invocation operator (<code>!</code>).</p>
<p>These macros are defined by a function with the <code>proc_macro</code>
<a href="attributes.html">attribute</a> inside a <code>proc_macros!</code> section, using an empty signature.</p>
<pre><code class="language-ds">proc_macros! {
    lang = &quot;rust&quot;;
    path = &quot;./my_proc_macros&quot;;

    #[proc_macro]
    fn my_function_macro();
}
</code></pre>
<p>Function-like procedural macros may be invoked in any macro invocation
position, which includes <a href="statements.html">statements</a>, <a href="expressions.html">expressions</a>, <a href="patterns.html">patterns</a>, <a href="types.html#type-expressions">type
expressions</a>, <a href="items.html">item</a> positions, including items in <a href="items/external-blocks.html"><code>extern</code> blocks</a>, inherent
and trait <a href="items/implementations.html">implementations</a>, and <a href="items/traits.html">trait definitions</a>.</p>
<h3 id="derive-macros"><a class="header" href="#derive-macros">Derive macros</a></h3>
<p><em>Derive macros</em> define new inputs for the <a href="attributes/derive.html"><code>derive</code> attribute</a>. These macros
can create new <a href="items.html">items</a> given the token stream of a <a href="items/structs.html">struct</a> or <a href="items/enumerations.html">enum</a>.
They can also define <a href="procedural-macros.html#derive-macro-helper-attributes">derive macro helper attributes</a>.</p>
<p>Custom derive macros are defined by a function with the
<code>proc_macro_derive</code> attribute and an empty signature inside a <code>proc_macros</code> section:</p>
<pre><code class="language-ds">proc_macros! {
    lang = &quot;rust&quot;;
    path = &quot;./my_proc_macros&quot;;

    #[proc_macro_derive(DeriveMacro)]
    fn my_derive_macro();
}
</code></pre>
<h4 id="derive-macro-helper-attributes"><a class="header" href="#derive-macro-helper-attributes">Derive macro helper attributes</a></h4>
<p>Derive macros can add additional <a href="attributes.html">attributes</a> into the scope of the <a href="items.html">item</a>
they are on. Said attributes are called <em>derive macro helper attributes</em>. These
attributes are <a href="attributes.html#active-and-inert-attributes">inert</a>, and their only purpose is to be fed into the derive
macro that defined them. That said, they can be seen by all macros.</p>
<p>The way to define helper attributes is to put an <code>attributes</code> key in the
<code>proc_macro_derive</code> attribute with a comma separated list of identifiers that are
the names of the helper attributes.</p>
<p>For example, the following derive macro defines a helper attribute
<code>helper</code>, but ultimately doesn't do anything with it.</p>
<pre><code class="language-ds">proc_macros! {
    lang = &quot;rust&quot;;
    path = &quot;./my_proc_macros&quot;;

    #[proc_macro_derive(HelperAttr, attributes(helper))]
    fn derive_helper_attr();
}
</code></pre>
<p>The process:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use ds_proc_macro::{TokenStream, proc_macros};

proc_macros! {
    #[proc_macro_derive]
    fn derive_helper_attr(_item_input: TokenStream) -&gt; TokenStream {
        TokenStream::new()
    }
}
<span class="boring">}</span></code></pre></pre>
<p>And then usage on the derive macro on a struct:</p>
<pre><code class="language-ds">#[derive(HelperAttr)]
struct Struct {
    #[helper] field: ()
}
</code></pre>
<h3 id="attribute-macros"><a class="header" href="#attribute-macros">Attribute macros</a></h3>
<p><em>Attribute macros</em> define new <a href="attributes.html">outer attributes</a> which can be
attached to <a href="items.html">items</a>, inherent and trait
<a href="items/implementations.html">implementations</a>, and <a href="items/traits.html">trait definitions</a>.</p>
<p>Attribute macros are defined by a function with the
<code>proc_macro_attribute</code> <a href="attributes.html">attribute</a> and an empty signature:</p>
<pre><code class="language-ds">proc_macros! {
    lang = &quot;rust&quot;;
    path = &quot;./my_proc_macros&quot;;

    #[proc_macro_attribute]
    fn attribute_macro();
}
</code></pre>
<p>The process referred by the <code>proc_macros!</code> section is based on the following Rust code:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use ds_proc_macro::{TokenStream, proc_macros};

proc_macros! {
    /// # Parameters
    ///
    /// - `attribute` is the delimited token following the attribute's
    /// name, not including the outer delimiters.
    /// - `item` is the rest of the item, including other attributes
    /// on the item.
    ///
    /// # Return
    ///
    /// The returned `TokenStream` replaces the item with an
    /// arbitrary number of items.
    ///
    #[proc_macro_attribute]
    fn attribute_macro(attribute: TokenStream, item: TokenStream) -&gt; TokenStream {
        output
    }
}
<span class="boring">}</span></code></pre></pre>
<h3 id="declarative-macro-tokens-and-procedural-macro-tokens"><a class="header" href="#declarative-macro-tokens-and-procedural-macro-tokens">Declarative macro tokens and procedural macro tokens</a></h3>
<p>Declarative <code>macro</code>s and procedural macros use similar, but
different definitions for tokens (or rather <a href="../proc_macro/enum.TokenTree.html"><code>TokenTree</code>s</a>.)</p>
<p>Token trees in <code>macro</code> (corresponding to <code>tt</code> matchers) are defined as</p>
<ul>
<li>Delimited groups (<code>(...)</code>, <code>{...}</code>, etc)</li>
<li>All operators supported by the language, both single-character and
multi-character ones (<code>+</code>, <code>+=</code>).
<ul>
<li>Note that this set doesn't include the single quote <code>'</code>.</li>
</ul>
</li>
<li>Literals (<code>&quot;string&quot;</code>, <code>1</code>, etc)
<ul>
<li>Note that negation (e.g. <code>-1</code>) is never a part of such literal tokens,
but a separate operator token.</li>
</ul>
</li>
<li>Identifiers, including keywords (<code>ident</code>, <code>r#ident</code>, <code>fn</code>)</li>
<li>Labels (<code>'ident</code>)</li>
<li>Metavariable substitutions in <code>macro</code> (e.g. <code>$my_expr</code> in
<code>macro mac { ($my_expr: expr) =&gt; { $my_expr } }</code> after the <code>mac</code>'s
expansion, which will be considered a single token tree regardless of the
passed expression)</li>
</ul>
<p>Token trees in procedural macros are defined as</p>
<ul>
<li>Delimited groups (<code>(...)</code>, <code>{...}</code>, etc)</li>
<li>All operators supported by the language, both single-character and
multi-character ones (<code>+</code>, <code>+=</code>).</li>
<li>Literals (<code>&quot;string&quot;</code>, <code>1</code>, etc)
<ul>
<li>Negation (e.g. <code>-1</code>) is supported as a part of integer
and floating point literals.</li>
</ul>
</li>
<li>Identifiers, including keywords (<code>ident</code>, <code>r#ident</code>, <code>fn</code>)</li>
<li>Labels</li>
</ul>
<p>Mismatches between these two definitions are accounted for when token streams
are passed to and from procedural macros. <br />
Note that the conversions below may happen lazily, so they might not happen if
the tokens are not actually inspected.</p>
<p>When passed to a proc-macro</p>
<ul>
<li>All multi-character operators are broken into single characters.</li>
<li>All metavariable substitutions are represented as their underlying token
streams.
<ul>
<li>Such token streams may be wrapped into delimited groups (<a href="../proc_macro/struct.Group.html"><code>Group</code></a>) with
implicit delimiters (<code>Delimiter::None</code>) when it's necessary for
preserving parsing priorities.</li>
<li><code>tt</code> and <code>ident</code> substitutions are never wrapped into such groups and
always represented as their underlying token trees.</li>
</ul>
</li>
</ul>
<p>When emitted from a proc macro</p>
<ul>
<li>Negative literals are converted into two tokens (the <code>-</code> and the literal)
possibly wrapped into a delimited group (<a href="../proc_macro/struct.Group.html"><code>Group</code></a>) with implicit delimiters
(<code>Delimiter::None</code>) when it's necessary for preserving parsing priorities.</li>
</ul>
<p>Note that neither declarative nor procedural macros support doc comment tokens
(e.g. <code>/// Doc</code>), so they are always converted to token streams representing
their equivalent <code>#[doc = r&quot;str&quot;]</code> attributes when passed to macros.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="crates-and-source-files"><a class="header" href="#crates-and-source-files">Crates and source files</a></h1>
<blockquote>
<p><strong><sup>Syntax</sup></strong><br />
<em>Crate</em> :<br />
   UTF8BOM<sup>?</sup><br />
   <a href="attributes.html"><em>InnerAttribute</em></a><sup>*</sup><br />
   <a href="items.html"><em>Item</em></a><sup>*</sup></p>
</blockquote>
<blockquote>
<p><strong><sup>Lexer</sup></strong><br />
UTF8BOM : <code>\uFEFF</code></p>
</blockquote>
<blockquote>
<p>Note: Although DS, like any other language, can be implemented by an
interpreter as well as a compiler, the only existing implementation is a
compiler, and the language has always been designed to be compiled. For these
reasons, this section assumes a compiler.</p>
</blockquote>
<p>DS's semantics obey a <em>phase distinction</em> between compile-time and
run-time.<sup class="footnote-reference"><a href="#phase-distinction">1</a></sup> Semantic rules that have a <em>static
interpretation</em> govern the success or failure of compilation, while
semantic rules that have a <em>dynamic interpretation</em> govern the behavior of the
program at run-time.</p>
<p>The compilation model centers on artifacts called <em>crates</em>. Each compilation
processes a single crate in source form, and if successful, produces a single
crate in binary form: either an executable or some sort of
library.<sup class="footnote-reference"><a href="#cratesourcefile">2</a></sup></p>
<p>A <em>crate</em> is a unit of compilation and linking, as well as versioning,
distribution, and runtime loading. A crate contains a <em>tree</em> of nested
<a href="items/modules.html">module</a> scopes. The top level of this tree is a module that is
anonymous (from the point of view of paths within the module) and any item
within a crate has a canonical <a href="paths.html">module path</a> denoting its location
within the crate's module tree.</p>
<p>The DS compiler is always invoked with a single source file as input, and
always produces a single output crate. The processing of that source file may
result in other source files being loaded as modules. Source files have the
extension <code>.ds</code>.</p>
<p>A DS source file describes a module, the name and location of which —
in the module tree of the current crate — are defined from outside the
source file: either by an explicit <a href="items/modules.html"><em>Module</em></a> item in a referencing
source file, or by the name of the crate itself. Every source file is a
module, but not every module needs its own source file: <a href="items/modules.html">module
definitions</a> can be nested within one file.</p>
<p>Each source file contains a sequence of zero or more <a href="items.html"><em>Item</em></a> definitions, and
may optionally begin with any number of <a href="attributes.html">attributes</a>
that apply to the containing module, most of which influence the behavior of
the compiler. The anonymous crate module can have additional attributes that
apply to the crate as a whole.</p>
<pre><code class="language-ds">// Specify the crate name.
#![crate_name = &quot;projx&quot;]

// Specify the type of output artifact.
#![crate_type = &quot;lib&quot;]

// Turn on a warning.
// This can be done in any module, not just the anonymous crate module.
#![warn(non_camel_case_types)]
</code></pre>
<h2 id="byte-order-mark"><a class="header" href="#byte-order-mark">Byte order mark</a></h2>
<p>The optional <a href="https://en.wikipedia.org/wiki/Byte_order_mark#UTF-8"><em>UTF8 byte order mark</em></a> (UTF8BOM production) indicates that the
file is encoded in UTF8. It can only occur at the beginning of the file and
is ignored by the compiler.</p>
<h2 id="main-functions"><a class="header" href="#main-functions">Main Functions</a></h2>
<p>A crate that contains a <code>main</code> <a href="items/functions.html">function</a> can be compiled to an executable. If a
<code>main</code> function is present, it must take no arguments, must not declare any
<a href="trait-bounds.html">trait bounds</a>, must not have any <a href="items/generics.html#where-clauses">where clauses</a>, and its return
type must be <code>()</code>.</p>
<pre><code class="language-ds">fn main() {}
</code></pre>
<h2 id="the-crate_name-attribute"><a class="header" href="#the-crate_name-attribute">The <code>crate_name</code> attribute</a></h2>
<p>The <em><code>crate_name</code> <a href="attributes.html">attribute</a></em> may be applied at the crate level to specify the
name of the crate with the <a href="attributes.html#meta-item-attribute-syntax"><em>MetaNameValueStr</em></a> syntax.</p>
<pre><code class="language-ds">#![crate_name = &quot;mycrate&quot;]
</code></pre>
<p>The crate name must not be empty, and must only contain <a href="../std/primitive.char.html#method.is_alphanumeric">Unicode alphanumeric</a>
or <code>_</code> (U+005F) characters.</p>
<div class="footnote-definition" id="phase-distinction"><sup class="footnote-definition-label">1</sup>
<p>This distinction would also exist in an interpreter.
Static checks like syntactic analysis, type checking, and lints should
happen before the program is executed regardless of when it is executed.</p>
</div>
<div class="footnote-definition" id="cratesourcefile"><sup class="footnote-definition-label">2</sup>
<p>A crate is somewhat analogous to an <em>assembly</em> in the
ECMA-335 CLI model, a <em>library</em> in the SML/NJ Compilation Manager, a <em>unit</em>
in the Owens and Flatt module system, or a <em>configuration</em> in Mesa.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="conditional-compilation"><a class="header" href="#conditional-compilation">Conditional compilation</a></h1>
<blockquote>
<p><strong><sup>Syntax</sup></strong><br />
<em>ConfigurationPredicate</em> :<br />
      <em>ConfigurationOption</em><br />
   | <em>ConfigurationAll</em><br />
   | <em>ConfigurationAny</em><br />
   | <em>ConfigurationNot</em></p>
<p><em>ConfigurationOption</em> :<br />
   <a href="identifiers.html">IDENTIFIER</a> (<code>=</code> (<a href="tokens.html#string-literals">STRING_LITERAL</a> | <a href="tokens.html#raw-string-literals">RAW_STRING_LITERAL</a>))<sup>?</sup></p>
<p><em>ConfigurationAll</em><br />
   <code>all</code> <code>(</code> <em>ConfigurationPredicateList</em><sup>?</sup> <code>)</code></p>
<p><em>ConfigurationAny</em><br />
   <code>any</code> <code>(</code> <em>ConfigurationPredicateList</em><sup>?</sup> <code>)</code></p>
<p><em>ConfigurationNot</em><br />
   <code>not</code> <code>(</code> <em>ConfigurationPredicate</em> <code>)</code></p>
<p><em>ConfigurationPredicateList</em><br />
   <em>ConfigurationPredicate</em> (<code>,</code> <em>ConfigurationPredicate</em>)<sup>*</sup> <code>,</code><sup>?</sup></p>
</blockquote>
<p><em>Conditionally compiled source code</em> is source code that may or may not be
considered a part of the source code depending on certain conditions. <!-- This
definition is sort of vacuous --> Source code can be conditionally compiled
using the <a href="attributes.html">attributes</a> <a href="conditional-compilation.html#the-cfg-attribute"><code>cfg</code></a> and <a href="conditional-compilation.html#the-cfg_attr-attribute"><code>cfg_attr</code></a> and the built-in <a href="conditional-compilation.html#the-cfg-macro"><code>cfg</code> macro</a>.
These conditions are based on the target architecture of the compiled crate,
arbitrary values passed to the compiler, and a few other miscellaneous things
further described below in detail.</p>
<p>Each form of conditional compilation takes a <em>configuration predicate</em> that
evaluates to true or false. The predicate is one of the following:</p>
<ul>
<li>A configuration option. It is true if the option is set and false if it is
unset.</li>
<li><code>all()</code> with a comma separated list of configuration predicates. It is false
if at least one predicate is false. If there are no predicates, it is true.</li>
<li><code>any()</code> with a comma separated list of configuration predicates. It is true
if at least one predicate is true. If there are no predicates, it is false.</li>
<li><code>not()</code> with a configuration predicate. It is true if its predicate is false
and false if its predicate is true.</li>
</ul>
<p><em>Configuration options</em> are names and key-value pairs that are either set or
unset. Names are written as a single identifier.
Key-value pairs are written as an identifier, <code>=</code>, and then a string. For
example, <code>feature = &quot;foo&quot;</code> is a configuration option.</p>
<blockquote>
<p><strong>Note</strong>: Whitespace around the <code>=</code> is ignored. <code>foo=&quot;bar&quot;</code> and <code>foo = &quot;bar&quot;</code>
are equivalent configuration options.</p>
</blockquote>
<p>Keys are not unique in the set of key-value configuration options. For example,
both <code>feature = &quot;foo&quot;</code> and <code>feature = &quot;qux&quot;</code> can be set at the same time.</p>
<h2 id="set-configuration-options"><a class="header" href="#set-configuration-options">Set Configuration Options</a></h2>
<p>Which configuration options are set is determined statically during the
compilation of the crate. Certain options are <em>compiler-set</em> based on data
about the compilation. Other options are <em>arbitrarily-set</em>, set based on input
passed to the compiler outside of the code. It is not possible to set a
configuration option from within the source code of the crate being compiled.</p>
<blockquote>
<p><strong>Note</strong>: Configuration options with the key <code>feature</code> are a convention used
by the DS package manager for specifying compile-time options and optional
dependencies.</p>
</blockquote>
<h3 id="test"><a class="header" href="#test"><code>test</code></a></h3>
<p>Enabled when compiling the test harness. See <a href="attributes/testing.html">Testing</a> for more on testing support.</p>
<h3 id="debug_assertions"><a class="header" href="#debug_assertions"><code>debug_assertions</code></a></h3>
<p>Enabled by default when compiling without optimizations.
This can be used to enable extra debugging code in development but not in
production.  For example, it controls the behavior of the standard library's
<code>debug_assert!</code> macro.</p>
<h2 id="forms-of-conditional-compilation"><a class="header" href="#forms-of-conditional-compilation">Forms of conditional compilation</a></h2>
<h3 id="the-cfg-attribute"><a class="header" href="#the-cfg-attribute">The <code>cfg</code> attribute</a></h3>
<blockquote>
<p><strong><sup>Syntax</sup></strong><br />
<em>CfgAttrAttribute</em> :<br />
   <code>cfg</code> <code>(</code> <em>ConfigurationPredicate</em> <code>)</code></p>
</blockquote>
<!-- should we say they're active attributes here? -->
<p>The <code>cfg</code> <a href="attributes.html">attribute</a> conditionally includes the thing it is attached to based
on a configuration predicate.</p>
<p>It is written as <code>cfg</code>, <code>(</code>, a configuration predicate, and finally <code>)</code>.</p>
<p>If the predicate is true, the thing is rewritten to not have the <code>cfg</code> attribute
on it. If the predicate is false, the thing is removed from the source code.</p>
<p>When a crate-level <code>cfg</code> has a false predicate, the behavior is slightly
different: any crate attributes preceding the <code>cfg</code> are kept, and any crate
attributes following the <code>cfg</code> are removed.</p>
<p>Some examples on functions:</p>
<pre><code class="language-ds">// The function is only included in the build when compiling with feature `foo`
#[cfg(feature = &quot;foo&quot;)]
fn foo_feature_only() {
  // ...
}

// This function is only included when either foo or bar is defined
#[cfg(any(foo, bar))]
fn needs_foo_or_bar() {
  // ...
}
</code></pre>
<p>The <code>cfg</code> attribute is allowed anywhere attributes are allowed.</p>
<h3 id="the-cfg_attr-attribute"><a class="header" href="#the-cfg_attr-attribute">The <code>cfg_attr</code> attribute</a></h3>
<blockquote>
<p><strong><sup>Syntax</sup></strong><br />
<em>CfgAttrAttribute</em> :<br />
   <code>cfg_attr</code> <code>(</code> <em>ConfigurationPredicate</em> <code>,</code> <em>CfgAttrs</em><sup>?</sup> <code>)</code></p>
<p><em>CfgAttrs</em> :<br />
   <a href="attributes.html"><em>Attr</em></a> (<code>,</code> <a href="attributes.html"><em>Attr</em></a>)<sup>*</sup> <code>,</code><sup>?</sup></p>
</blockquote>
<p>The <code>cfg_attr</code> <a href="attributes.html">attribute</a> conditionally includes <a href="attributes.html">attributes</a> based on a
configuration predicate.</p>
<p>When the configuration predicate is true, this attribute expands out to the
attributes listed after the predicate. For example, the following module will
either be found at <code>foo.ds</code> or <code>qux.ds</code> based on the feature <code>foo</code>.</p>
<pre><code class="language-ds">#[cfg_attr(feature = &quot;foo&quot;, path = &quot;foo.ds&quot;)]
#[cfg_attr(not(feature = &quot;foo&quot;), path = &quot;qux.ds&quot;)]
mod q;
</code></pre>
<p>Zero, one, or more attributes may be listed. Multiple attributes will each be
expanded into separate attributes. For example:</p>
<pre><code class="language-ds">#[cfg_attr(feature = &quot;magic&quot;, sparkles, crackles)]
fn bewitched() {}

// When the `magic` feature flag is enabled, the above will expand to:
#[sparkles]
#[crackles]
fn bewitched() {}
</code></pre>
<blockquote>
<p><strong>Note</strong>: The <code>cfg_attr</code> can expand to another <code>cfg_attr</code>. For example,
<code>#[cfg_attr(feature = &quot;foo&quot;, cfg_attr(feature = &quot;qux&quot;, some_other_attribute))]</code>
is valid. This example would be equivalent to
<code>#[cfg_attr(all(feature = &quot;foo&quot;, feature =&quot;qux&quot;), some_other_attribute)]</code>.</p>
</blockquote>
<p>The <code>cfg_attr</code> attribute is allowed anywhere attributes are allowed.</p>
<h3 id="the-cfg-macro"><a class="header" href="#the-cfg-macro">The <code>cfg</code> macro</a></h3>
<p>The built-in <code>cfg</code> macro takes in a single configuration predicate and evaluates
to the <code>true</code> literal when the predicate is true and the <code>false</code> literal when
it is false.</p>
<p>For example:</p>
<pre><code class="language-ds">let ft = if cfg!(feature = &quot;foo&quot;) {
    &quot;foo&quot;
} else if cfg!(feature = &quot;qux&quot;) {
    &quot;qux&quot;
} else {
    &quot;none&quot;
};

print!(&quot;Feature: {ft}&quot;);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="items"><a class="header" href="#items">Items</a></h1>
<blockquote>
<p><strong><sup>Syntax:<sup></strong><br />
<em>Item</em>:<br />
   <a href="attributes.html"><em>OuterAttribute</em></a><sup>*</sup><br />
      <em>VisItem</em><br />
   | <em>MacroItem</em></p>
<p><em>VisItem</em>:<br />
   <a href="visibility-and-privacy.html"><em>Visibility</em></a><sup>?</sup><br />
   (<br />
          <a href="items/modules.html"><em>Module</em></a><br />
      | <a href="items/use-declarations.html"><em>UseDeclaration</em></a><br />
      | <a href="items/functions.html"><em>Function</em></a><br />
      | <a href="items/type-aliases.html"><em>TypeAlias</em></a><br />
      | <a href="items/structs.html"><em>Struct</em></a><br />
      | <a href="items/enumerations.html"><em>Enumeration</em></a><br />
      | <a href="items/constant-items.html"><em>ConstantItem</em></a><br />
      | <a href="items/static-items.html"><em>StaticItem</em></a><br />
      | <a href="items/traits.html"><em>Trait</em></a><br />
      | <a href="items/implementations.html"><em>Implementation</em></a><br />
      | <a href="macros-by-example.html"><em>MacroRulesDefinition</em></a><br />
   )</p>
<p><em>MacroItem</em>:<br />
      <a href="macros.html#macro-invocation"><em>MacroInvocationSemi</em></a></p>
</blockquote>
<p>An <em>item</em> is a component of a crate. Items are organized within a crate by a
nested set of <a href="items/modules.html">modules</a>. Every crate has a single &quot;outermost&quot; anonymous module;
all further items within the crate have <a href="paths.html">paths</a> within the module tree of the
crate.</p>
<p>Items are entirely determined at compile-time, generally remain fixed during
execution, and may reside in read-only memory.</p>
<p>There are several kinds of items:</p>
<ul>
<li><a href="items/modules.html">modules</a></li>
<li><a href="items/use-declarations.html"><code>use</code> declarations</a></li>
<li><a href="items/functions.html">function definitions</a></li>
<li><a href="items/type-aliases.html">type definitions</a></li>
<li><a href="items/structs.html">struct definitions</a></li>
<li><a href="items/enumerations.html">enumeration definitions</a></li>
<li><a href="items/constant-items.html">constant items</a></li>
<li><a href="items/static-items.html">static items</a></li>
<li><a href="items/traits.html">trait definitions</a></li>
<li><a href="items/implementations.html">implementations</a></li>
<li><a href="macros-by-example.html"><code>macro</code> definitions</a></li>
</ul>
<p>Some items form an implicit scope for the declaration of sub-items. In other
words, within a function or module, declarations of items can (in many cases)
be mixed with the statements, control blocks, and similar artifacts that
otherwise compose the item body. The meaning of these scoped items is the same
as if the item was declared outside the scope — it is still a static item
— except that the item's <em>path name</em> within the module namespace is
qualified by the name of the enclosing item, or is private to the enclosing
item (in the case of functions). The grammar specifies the exact locations in
which sub-item declarations may appear.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="modules"><a class="header" href="#modules">Modules</a></h1>
<blockquote>
<p><strong><sup>Syntax:</sup></strong><br />
<em>Module</em> :<br />
      <code>mod</code> <a href="items/../identifiers.html">IDENTIFIER</a> <code>;</code><br />
   | <code>mod</code> <a href="items/../identifiers.html">IDENTIFIER</a> <code>{</code><br />
        <a href="items/../attributes.html"><em>InnerAttribute</em></a><sup>*</sup><br />
        <a href="items/../items.html"><em>Item</em></a><sup>*</sup><br />
      <code>}</code></p>
</blockquote>
<p>A module is a container for zero or more <a href="items/../items.html">items</a>.</p>
<p>A <em>module item</em> is a module, surrounded in braces, named, and prefixed with the
keyword <code>mod</code>. A module item introduces a new, named module into the tree of
modules making up a crate. Modules can nest arbitrarily.</p>
<p>An example of a module:</p>
<pre><code class="language-ds">mod math {
    type Complex = (f64, f64);
    fn sin(f: f64) -&gt; f64 {
        /* ... */
    }
    fn cos(f: f64) -&gt; f64 {
        /* ... */
    }
    fn tan(f: f64) -&gt; f64 {
        /* ... */
    }
}
</code></pre>
<p>Modules and types share the same namespace. Declaring a named type with the
same name as a module in scope is forbidden: that is, a type definition, trait,
struct, enumeration, type parameter or crate can't shadow the name of a
module in scope, or vice versa. Items brought into scope with <code>use</code> also have
this restriction.</p>
<h2 id="module-source-filenames"><a class="header" href="#module-source-filenames">Module Source Filenames</a></h2>
<p>A module without a body is loaded from an external file. When the module does
not have a <code>path</code> attribute, the path to the file mirrors the logical <a href="items/../paths.html">module
path</a>. Ancestor module path components are directories, and the module's
contents are in a file with the name of the module plus the <code>.ds</code> extension.
For example, the following module structure can have this corresponding
filesystem structure:</p>
<div class="table-wrapper"><table><thead><tr><th>Module Path</th><th>Filesystem Path</th><th>File Contents</th></tr></thead><tbody>
<tr><td><code>crate</code></td><td><code>lib.ds</code></td><td><code>mod util;</code></td></tr>
<tr><td><code>crate::util</code></td><td><code>util.ds</code></td><td><code>mod config;</code></td></tr>
<tr><td><code>crate::util::config</code></td><td><code>util/config.ds</code></td><td></td></tr>
</tbody></table>
</div>
<h3 id="the-path-attribute"><a class="header" href="#the-path-attribute">The <code>path</code> attribute</a></h3>
<p>The directories and files used for loading external file modules can be
influenced with the <code>path</code> attribute.</p>
<p>For <code>path</code> attributes on modules not inside inline module blocks, the file
path is relative to the directory the source file is located. For example, the
following code snippet would use the paths shown based on where it is located:</p>
<pre><code class="language-ds">#[path = &quot;foo.ds&quot;]
mod c;
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Source File</th><th><code>c</code>'s File Location</th><th><code>c</code>'s Module Path</th></tr></thead><tbody>
<tr><td><code>src/a/b.ds</code></td><td><code>src/a/foo.ds</code></td><td><code>crate::a::b::c</code></td></tr>
<tr><td><code>src/a.ds</code></td><td><code>src/a/foo.ds</code></td><td><code>crate::a::c</code></td></tr>
</tbody></table>
</div>
<p>For <code>path</code> attributes inside inline module blocks, the relative location of
the file path depends on the kind of source file the <code>path</code> attribute is
located in. &quot;mod-ds&quot; source files are root modules (such as <code>lib.ds</code> or
<code>main.ds</code>). &quot;non-mod-ds&quot; source files are all other module files. Paths for <code>path</code> attributes inside inline module
blocks in a mod-ds file are relative to the directory of the mod-ds file
including the inline module components as directories. For non-mod-ds files,
it is the same except the path starts with a directory with the name of the
non-mod-ds module. For example, the following code snippet would use the paths
shown based on where it is located:</p>
<pre><code class="language-ds">mod inline {
    #[path = &quot;other.ds&quot;]
    mod inner;
}
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Source File</th><th><code>inner</code>'s File Location</th><th><code>inner</code>'s Module Path</th></tr></thead><tbody>
<tr><td><code>src/a/b.ds</code></td><td><code>src/a/b/inline/other.ds</code></td><td><code>crate::a::b::inline::inner</code></td></tr>
<tr><td><code>src/a/mod.ds</code></td><td><code>src/a/inline/other.ds</code></td><td><code>crate::a::inline::inner</code></td></tr>
</tbody></table>
</div>
<p>An example of combining the above rules of <code>path</code> attributes on inline modules
and nested modules within (applies to both mod-ds and non-mod-ds files):</p>
<pre><code class="language-ds">#[path = &quot;foo_files&quot;]
mod foo {
    // Load the `qux` module from `foo_files/bar.ds` relative to
    // this source file's directory.
    #[path = &quot;bar.ds&quot;]
    mod qux;
}
</code></pre>
<h2 id="attributes-on-modules"><a class="header" href="#attributes-on-modules">Attributes on Modules</a></h2>
<p>Modules, like all items, accept outer attributes. They also accept inner
attributes: either after <code>{</code> for a module with a body, or at the beginning of the
source file, after the optional BOM.</p>
<p>The built-in attributes that have meaning on a module are <a href="items/../conditional-compilation.html"><code>cfg</code></a>,
<a href="items/../attributes/diagnostics.html#the-deprecated-attribute"><code>deprecated</code></a>, <a href="items/../../dsdoc/the-doc-attribute.html"><code>doc</code></a>, <a href="items/../attributes/diagnostics.html#lint-check-attributes">the lint check attributes</a>, <a href="items/modules.html#the-path-attribute"><code>path</code></a>, and
<a href="items/../names/preludes.html#the-no_implicit_prelude-attribute"><code>no_implicit_prelude</code></a>. Modules also accept macro attributes.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="use-declarations"><a class="header" href="#use-declarations">Use declarations</a></h1>
<blockquote>
<p><strong><sup>Syntax:</sup></strong><br />
<em>UseDeclaration</em> :<br />
   <code>use</code> <em>UseTree</em> <code>;</code></p>
<p><em>UseTree</em> :<br />
      (<a href="items/../paths.html#simple-paths"><em>SimplePath</em></a><sup>?</sup> <code>::</code>)<sup>?</sup> <code>*</code><br />
   | (<a href="items/../paths.html#simple-paths"><em>SimplePath</em></a><sup>?</sup> <code>::</code>)<sup>?</sup> <code>{</code> (<em>UseTree</em> ( <code>,</code>  <em>UseTree</em> )<sup>*</sup> <code>,</code><sup>?</sup>)<sup>?</sup> <code>}</code><br />
   | <a href="items/../paths.html#simple-paths"><em>SimplePath</em></a> ( <code>as</code> ( <a href="items/../identifiers.html">IDENTIFIER</a> | <code>_</code> ) )<sup>?</sup></p>
</blockquote>
<p>A <em>use declaration</em> creates one or more local name bindings synonymous with
some other <a href="items/../paths.html">path</a>. Usually a <code>use</code> declaration is used to shorten the path
required to refer to a module item. These declarations may appear in <a href="items/modules.html">modules</a>
and <a href="items/../expressions/block-expr.html">blocks</a>, usually at the top.</p>
<p>Use declarations support a number of convenient shortcuts:</p>
<ul>
<li>Simultaneously binding a list of paths with a common prefix, using the
glob-like brace syntax <code>use a::b::{c, d, e::f, g::h::i};</code></li>
<li>Simultaneously binding a list of paths with a common prefix and their common
parent module, using the <code>self</code> keyword, such as <code>use a::b::{self, c, d::e};</code></li>
<li>Rebinding the target name as a new local name, using the syntax <code>use p::q::r as x;</code>. This can also be used with the last two features:
<code>use a::b::{self as ab, c as abc}</code>.</li>
<li>Binding all paths matching a given prefix, using the asterisk wildcard syntax
<code>use a::b::*;</code>.</li>
<li>Nesting groups of the previous features multiple times, such as
<code>use a::b::{self as ab, c, d::{*, e::f}};</code></li>
</ul>
<h2 id="use-visibility"><a class="header" href="#use-visibility"><code>use</code> Visibility</a></h2>
<p>Like items, <code>use</code> declarations are private to the containing module, by
default. Also like items, a <code>use</code> declaration can be public, if qualified by
the <code>pub</code> keyword. Such a <code>use</code> declaration serves to <em>re-export</em> a name. A
public <code>use</code> declaration can therefore <em>redirect</em> some public name to a
different target definition: even a definition with a private canonical path,
inside a different module. If a sequence of such redirections form a cycle or
cannot be resolved unambiguously, they represent a compile-time error.</p>
<p>An example of re-exporting:</p>
<pre><code class="language-ds">mod quux {
    pub use self::foo::{bar, baz};
    pub mod foo {
        pub fn bar() {}
        pub fn baz() {}
    }
}

fn main() {
    quux::bar();
    quux::baz();
}
</code></pre>
<p>In this example, the module <code>quux</code> re-exports two public names defined in
<code>foo</code>.</p>
<h2 id="underscore-imports"><a class="header" href="#underscore-imports">Underscore Imports</a></h2>
<p>Items can be imported without binding to a name by using an underscore with
the form <code>use path as _</code>. This is particularly useful to import a trait so
that its methods may be used without importing the trait's symbol, for example
if the trait's symbol may conflict with another symbol.</p>
<p>Asterisk glob imports will import items imported with <code>_</code> in their unnameable
form.</p>
<pre><code class="language-ds">mod foo {
    pub trait Zoo {
        fn zoo(&amp;self) {}
    }

    impl&lt;T&gt; Zoo for T {}
}

use self::foo::Zoo as _;
struct Zoo;  // Underscore import avoids name conflict with this item.

fn main() {
    let z = Zoo;
    z.zoo();
}
</code></pre>
<p>The unique, unnameable symbols are created after macro expansion so that
macros may safely emit multiple references to <code>_</code> imports. For example, the
following should not produce an error:</p>
<pre><code class="language-ds">macro m {
    ($item: item) =&gt; { $item $item },
}

m!(use std as _;);
// This expands to:
// use std as _;
// use std as _;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="functions"><a class="header" href="#functions">Functions</a></h1>
<blockquote>
<p><strong><sup>Syntax</sup></strong><br />
<em>Function</em> :<br />
   <em>FunctionQualifiers</em> <code>fn</code> <a href="items/../identifiers.html">IDENTIFIER</a> <a href="items/generics.html"><em>GenericParams</em></a><sup>?</sup><br />
      <code>(</code> <em>FunctionParameters</em><sup>?</sup> <code>)</code><br />
      <em>FunctionReturnType</em><sup>?</sup> <a href="items/generics.html#where-clauses"><em>WhereClause</em></a><sup>?</sup><br />
      ( <a href="items/../expressions/block-expr.html"><em>BlockExpression</em></a> | <code>;</code> )</p>
<p><em>FunctionQualifiers</em> :<br />
   <code>async</code><sup>?</sup> <code>extern</code><sup>?</sup> <code>override</code><sup>?</sup></p>
<p><em>FunctionParameters</em> :<br />
      <em>SelfParam</em> <code>,</code><sup>?</sup><br />
   | (<em>SelfParam</em> <code>,</code>)<sup>?</sup> <em>FunctionParam</em> (<code>,</code> <em>FunctionParam</em>)<sup>*</sup> <code>,</code><sup>?</sup></p>
<p><em>SelfParam</em> :<br />
   <a href="items/../attributes.html"><em>OuterAttribute</em></a><sup>*</sup> ( <em>ShorthandSelf</em> | <em>TypedSelf</em> )</p>
<p><em>ShorthandSelf</em> :<br />
    <code>self</code></p>
<p><em>TypedSelf</em> :<br />
   <code>self</code> <code>:</code> <a href="items/../types.html#type-expressions"><em>Type</em></a></p>
<p><em>FunctionParam</em> :<br />
   <a href="items/../attributes.html"><em>OuterAttribute</em></a><sup>*</sup> (
<em>FunctionParamPattern</em> | <code>...</code> | <a href="items/../types.html#type-expressions"><em>Type</em></a>
)</p>
<p><em>FunctionParamPattern</em> :<br />
   <a href="items/../patterns.html"><em>PatternNoTopAlt</em></a> <code>:</code> ( <a href="items/../types.html#type-expressions"><em>Type</em></a> | <code>...</code> )</p>
<p><em>FunctionReturnType</em> :<br />
   <code>-&gt;</code> <a href="items/../types.html#type-expressions"><em>Type</em></a></p>
</blockquote>
<p>A <em>function</em> consists of a <a href="items/../expressions/block-expr.html">block</a>, along with a name, a set of parameters, and an output type.
Other than a name, all these are optional.
Functions are declared with the keyword <code>fn</code>.
Functions may declare a set of <em>input</em> <a href="items/../variables.html"><em>variables</em></a> as parameters, through which the caller passes arguments into the function, and the <em>output</em> <a href="items/../types.html#type-expressions"><em>type</em></a> of the value the function will return to its caller on completion.
If the output type is not explicitly stated, it is the <a href="items/../types/tuple.html">unit type</a>.</p>
<p>When referred to, a <em>function</em> yields a first-class <em>value</em> of the corresponding <a href="items/../types/function.html"><em>function type</em></a>, which when called evaluates to a direct call to the function.</p>
<p>For example, this is a simple function:</p>
<pre><code class="language-ds">fn answer_to_life_the_universe_and_everything() -&gt; i32 {
    return 42;
}
</code></pre>
<h2 id="function-parameters"><a class="header" href="#function-parameters">Function parameters</a></h2>
<p>Function parameters are irrefutable <a href="items/../patterns.html">patterns</a>, so any pattern that is valid in
an else-less <code>let</code> binding is also valid as a parameter:</p>
<pre><code class="language-ds">fn first((value, _): (i32, i32)) -&gt; i32 { value }
</code></pre>
<p>If the first parameter is a <em>SelfParam</em>, this indicates that the function is a
<a href="items/associated-items.html#methods">method</a>. Functions with a self parameter may only appear as an <a href="items/associated-items.html#associated-functions-and-methods">associated
function</a> in a <a href="items/traits.html">trait</a> or <a href="items/implementations.html">implementation</a>.</p>
<p>If the function is a method named <code>new</code> belonging to a <code>struct</code>, it is a <a href="items/functions.html#constructor">constructor</a> method.</p>
<p>A parameter with the <code>...</code> token indicates a <a href="items/external-blocks.html#variadic-functions">variadic function</a>, and may only
be used as the last parameter of an external function. The variadic
parameter may have an optional identifier, such as <code>args: ...</code>.</p>
<h2 id="function-body"><a class="header" href="#function-body">Function body</a></h2>
<p>The block of a function is conceptually wrapped in a block that binds the
argument patterns and then <code>return</code>s the value of the function's block. This
means that the tail expression of the block, if evaluated, ends up being
returned to the caller. As usual, an explicit return expression within
the body of the function will short-cut that implicit return, if reached.</p>
<p>For example, the function above behaves as if it was written as:</p>
<pre><code class="language-ds">// argument_0 is the actual first argument passed from the caller
let (value, _) = argument_0;
return {
    value
};
</code></pre>
<p>Functions without a body block are terminated with a semicolon. This form
may only appear in a <a href="items/traits.html">trait</a> or when the function is qualified by <code>extern</code>.</p>
<h2 id="constructor"><a class="header" href="#constructor">Constructor</a></h2>
<p>A constructor method (a <code>new</code> method inside a <code>struct</code>) must have a signature that takes at least <code>self</code> and returns <code>()</code>. It is a compile error if the inherited structure is not directly <code>Object</code> and the constructor method is not external and does not contain a <code>super();</code> statement at the top of the block.</p>
<p>Example of a constructor:</p>
<pre><code class="language-ds">struct S;
impl S {
    fn new(self) {}
}
</code></pre>
<h2 id="generic-functions"><a class="header" href="#generic-functions">Generic functions</a></h2>
<p>A <em>generic function</em> allows one or more <em>parameterized types</em> to appear in its
signature. Each type parameter must be explicitly declared in an
angle-bracket-enclosed and comma-separated list, following the function name.</p>
<pre><code class="language-ds">// foo is generic over A and B

fn foo&lt;A, B&gt;(x: A, y: B) {}
</code></pre>
<p>Inside the function signature and body, the name of the type parameter can be
used as a type name. <a href="items/traits.html">Trait</a> bounds can be specified for type
parameters to allow methods with that trait to be called on values of that
type. This is specified using the <code>where</code> syntax:</p>
<pre><code class="language-ds">use ds::fmt::Debug;
fn foo&lt;T&gt;(x: T) where T: Debug {}
</code></pre>
<p>When a generic function is referenced, its type is instantiated based on the
context of the reference. For example, calling the <code>foo</code> function here:</p>
<pre><code class="language-ds">use ds::fmt::Debug;

fn foo&lt;T&gt;(x: [T]) where T: Debug {
    // details elided
}

foo([1, 2]);
</code></pre>
<p>will instantiate type parameter <code>T</code> with <code>i32</code>.</p>
<p>The type parameters can also be explicitly supplied in a trailing <a href="items/../paths.html">path</a>
component after the function name. This might be necessary if there is not
sufficient context to determine the type parameters. For example,
<code>memory::size_of::&lt;u32&gt;() == 4</code>.</p>
<h2 id="external-functions"><a class="header" href="#external-functions">External functions</a></h2>
<p>The <code>extern</code> keyword indicates that a function is external and is imported from ActionScript. External functions must contain no body. An external function can be variadic.</p>
<p>An external function may use the <code>#[actionscript]</code> attribute with the following possible key-value pairs and names:</p>
<ul>
<li><code>package = &quot;q1.q2&quot;</code>: indicates the ActionScript package that qualifies the function. The <code>public</code> visibility is used.</li>
<li><code>name = &quot;name&quot;</code>: indicates the ActionScript property name.</li>
<li><code>get</code>: indicates that the imported ActionScript item is a variable or virtual property and that the external function is equivalent to a get-property operation.</li>
<li><code>set</code>: indicates that the imported ActionScript item is a variable or virtual property and that the external function is equivalent to a set-property operation.</li>
</ul>
<p>Examples of external functions:</p>
<pre><code class="language-ds">#[actionscript(package = &quot;com.q&quot;)]
extern fn some_function();

#[actionscript(package = &quot;com.q&quot;, name = &quot;camelCase&quot;)]
extern fn snake_case();

#[actionscript(get, package = &quot;com.q&quot;, name = &quot;x&quot;)]
extern fn x();

impl S {
    #[actionscript(get, name = &quot;x&quot;)]
    extern fn x(self) -&gt; f64;

    #[actionscript(set, name = &quot;x&quot;)]
    extern fn set_x(self, value: f64);
}
</code></pre>
<h2 id="overriding"><a class="header" href="#overriding">Overriding</a></h2>
<p>If a method function overrides a method in a super structure, it must be marked <code>override</code>. The override signature must be of the same function type.</p>
<pre><code class="language-ds">impl S {
    pub override fn f(self) {}
}
</code></pre>
<h2 id="async-functions"><a class="header" href="#async-functions">Async functions</a></h2>
<p>Functions may be qualified as async:</p>
<pre><code class="language-ds">async fn regular_example() { }
</code></pre>
<p>Async functions execute directly when called, returning the <code>Future&lt;T&gt;</code> structure.</p>
<pre><code class="language-ds">// Source
async fn example(x: str) -&gt; u32 {
    x.len()
}
</code></pre>
<p>is roughly equivalent to:</p>
<pre><code class="language-ds">// Desugared
fn example(x: str) -&gt; Future&lt;u32&gt; {
    async { x.len() }
}
</code></pre>
<p>For more information on the effect of async, see <a href="items/../expressions/block-expr.html#async-blocks"><code>async</code> blocks</a>.</p>
<h2 id="generator-functions"><a class="header" href="#generator-functions">Generator functions</a></h2>
<p>Functions that contain the <code>yield</code> operator are generators. A generator returns <code>Iterator</code>.</p>
<pre><code class="language-ds">// fn f() -&gt; Iterator&lt;Item = i32&gt;
fn f() -&gt; i32 {
    for i in 0..10 {
        yield i;
    }
}
</code></pre>
<h2 id="asynchronous-generators"><a class="header" href="#asynchronous-generators">Asynchronous generators</a></h2>
<p>A generator can be asynchronous, returning <code>Iterator&lt;Item = Future&lt;T&gt;&gt;</code>.</p>
<pre><code class="language-ds">// fn f() -&gt; Iterator&lt;Item = Future&lt;i32&gt;&gt;
async fn f() -&gt; i32 {
    for i in 0..10 {
        yield fetch_integer().await;
    }
}
</code></pre>
<h2 id="attributes-on-functions"><a class="header" href="#attributes-on-functions">Attributes on functions</a></h2>
<p><a href="items/../attributes.html">Outer attributes</a> are allowed on functions. <a href="items/../attributes.html">Inner
attributes</a> are allowed directly after the <code>{</code> inside its <a href="items/../expressions/block-expr.html">block</a>.</p>
<p>This example shows an inner attribute on a function. The function is documented
with just the word &quot;Example&quot;.</p>
<pre><code class="language-ds">fn documented() {
    #![doc = &quot;Example&quot;]
}
</code></pre>
<blockquote>
<p>Note: Except for lints, it is idiomatic to only use outer attributes on
function items.</p>
</blockquote>
<p>The attributes that have meaning on a function are <code>actionscript</code>, <a href="items/../conditional-compilation.html#the-cfg-attribute"><code>cfg</code></a>, <a href="items/../conditional-compilation.html#the-cfg_attr-attribute"><code>cfg_attr</code></a>, <a href="items/../attributes/diagnostics.html#the-deprecated-attribute"><code>deprecated</code></a>,
<a href="items/../../dsdoc/the-doc-attribute.html"><code>doc</code></a>, <a href="items/../attributes/diagnostics.html#lint-check-attributes">the lint check
attributes</a>, <a href="items/../procedural-macros.html">the procedural macro attributes</a>, <a href="items/../attributes/testing.html">the testing
attributes</a>, and <a href="items/../attributes/codegen.html#optimization-hints">the optimization hint attributes</a>. Functions also accept
attributes macros.</p>
<h2 id="attributes-on-function-parameters"><a class="header" href="#attributes-on-function-parameters">Attributes on function parameters</a></h2>
<p><a href="items/../attributes.html">Outer attributes</a> are allowed on function parameters and the
permitted <a href="items/../attributes.html#built-in-attributes-index">built-in attributes</a> are restricted to <code>cfg</code>, <code>cfg_attr</code>, <code>allow</code>,
<code>warn</code>, <code>deny</code>, and <code>forbid</code>.</p>
<pre><code class="language-ds">fn f(
    #[cfg(foo)] a: [f64],
    #[cfg(not(foo))] a: [u32],
) {
}
</code></pre>
<p>Inert helper attributes used by procedural macro attributes applied to items are also
allowed but be careful to not include these inert attributes in your final <code>TokenStream</code>.</p>
<p>For example, the following code defines an inert <code>some_inert_attribute</code> attribute that
is not formally defined anywhere and the <code>some_proc_macro_attribute</code> procedural macro is
responsible for detecting its presence and removing it from the output token stream.</p>
<pre><code class="language-ds ignore">#[some_proc_macro_attribute]
fn foo_oof(#[some_inert_attribute] arg: u32) {
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="type-aliases"><a class="header" href="#type-aliases">Type aliases</a></h1>
<blockquote>
<p><strong><sup>Syntax</sup></strong><br />
<em>TypeAlias</em> :<br />
   <code>type</code> <a href="items/../identifiers.html">IDENTIFIER</a> <a href="items/generics.html"><em>GenericParams</em></a><sup>?</sup>
( <code>:</code> <a href="items/../trait-bounds.html"><em>TypeParamBounds</em></a> )<sup>?</sup>
( <code>=</code> <a href="items/../types.html#type-expressions"><em>Type</em></a> <a href="items/generics.html#where-clauses"><em>WhereClause</em></a><sup>?</sup>)<sup>?</sup> <code>;</code></p>
</blockquote>
<p>A <em>type alias</em> defines a new name for an existing <a href="items/../types.html">type</a>. Type aliases are
declared with the keyword <code>type</code>. Every value has a single, specific type, but
may implement several different traits, or be compatible with several different
type constraints.</p>
<p>For example, the following defines the type <code>Point</code> as a synonym for the type
<code>(u32, u32)</code>, the type of pairs of unsigned 8 bit integers:</p>
<pre><code class="language-ds">type Point = (u32, u32);
let p: Point = (41, 68);
</code></pre>
<p>A type alias to a tuple-struct or unit-struct cannot be used to qualify that type's constructor:</p>
<pre><code class="language-ds compile_fail">struct MyStruct(u32);

use MyStruct as UseAlias;
type TypeAlias = MyStruct;

let _ = UseAlias(5); // OK
let _ = TypeAlias(5); // Doesn't work
</code></pre>
<p>A type alias, when not used as an associated type, must include a <a href="items/../types.html#type-expressions"><em>Type</em></a> and
may not include <a href="items/../trait-bounds.html"><em>TypeParamBounds</em></a>.</p>
<p>A type alias, when used as an <a href="items/associated-items.html#associated-types">associated type</a> in a <a href="items/traits.html">trait</a>, must not include a
<a href="items/../types.html#type-expressions"><em>Type</em></a> specification but may include <a href="items/../trait-bounds.html"><em>TypeParamBounds</em></a>.</p>
<p>A type alias, when used as an <a href="items/associated-items.html#associated-types">associated type</a> in a <a href="items/implementations.html#trait-implementations">trait impl</a>, must include
a <a href="items/../types.html#type-expressions"><em>Type</em></a> specification and may not include <a href="items/../trait-bounds.html"><em>TypeParamBounds</em></a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="structs"><a class="header" href="#structs">Structs</a></h1>
<blockquote>
<p><strong><sup>Syntax</sup></strong><br />
<em>Struct</em> :<br />
      <em>StructStruct</em><br />
   | <em>TupleStruct</em></p>
<p><em>StructQualifiers</em> :<br />
   <code>extern</code><sup>?</sup></p>
<p><em>StructStruct</em> :<br />
   <em>StructQualifiers</em> <code>struct</code>
<a href="items/../identifiers.html">IDENTIFIER</a> 
<a href="items/generics.html"><em>GenericParams</em></a><sup>?</sup>
<em>InheritedStruct</em><sup>?</sup>
<a href="items/generics.html#where-clauses"><em>WhereClause</em></a><sup>?</sup>
( <code>{</code> <em>StructFields</em><sup>?</sup> <code>}</code> | <code>;</code> )</p>
<p><em>TupleStruct</em> :<br />
   <em>StructQualifiers</em> <code>struct</code>
<a href="items/../identifiers.html">IDENTIFIER</a> 
<a href="items/generics.html"><em>GenericParams</em></a><sup>?</sup>
<code>(</code> <em>TupleFields</em><sup>?</sup> <code>)</code>
<em>InheritedStruct</em><sup>?</sup>
<a href="items/generics.html#where-clauses"><em>WhereClause</em></a><sup>?</sup>
<code>;</code></p>
<p><em>StructFields</em> :<br />
   <em>StructField</em> (<code>,</code> <em>StructField</em>)<sup>*</sup> <code>,</code><sup>?</sup></p>
<p><em>StructField</em> :<br />
   <a href="items/../attributes.html"><em>OuterAttribute</em></a><sup>*</sup><br />
   <a href="items/../visibility-and-privacy.html"><em>Visibility</em></a><sup>?</sup><br />
   <code>mut</code><sup>?</sup><br />
   <a href="items/../identifiers.html">IDENTIFIER</a> <code>:</code> <a href="items/../types.html#type-expressions"><em>Type</em></a><br />
   (<code>=</code> [<em>Expression</em>])<sup>?</sup></p>
<p><em>TupleFields</em> :<br />
   <em>TupleField</em> (<code>,</code> <em>TupleField</em>)<sup>*</sup> <code>,</code><sup>?</sup></p>
<p><em>TupleField</em> :<br />
   <a href="items/../attributes.html"><em>OuterAttribute</em></a><sup>*</sup><br />
   <a href="items/../visibility-and-privacy.html"><em>Visibility</em></a><sup>?</sup><br />
   <code>mut</code><sup>?</sup><br />
   <a href="items/../types.html#type-expressions"><em>Type</em></a></p>
<p><em>InheritedStruct</em> :<br />
   <code>:</code> <a href="items/../types.html#type-expressions"><em>Type</em></a></p>
</blockquote>
<p>A <em>struct</em> is a nominal <a href="items/../types/struct.html">struct type</a> defined with the keyword <code>struct</code>.</p>
<p>An example of a <code>struct</code> item and its use:</p>
<pre><code class="language-ds">struct Point {x: i32, y: i32}
let p = Point {x: 10, y: 11};
let px: i32 = p.x;
</code></pre>
<p>A <em>tuple struct</em> is a nominal <a href="items/../types/tuple.html">tuple type</a>, also defined with the keyword
<code>struct</code>. For example:</p>
<pre><code class="language-ds">struct Point(i32, i32);
let p = Point(10, 11);
let px: i32 = match p { Point(x, _) =&gt; x };
</code></pre>
<p>A <em>unit-like struct</em> is a struct without any fields, defined by leaving off the
list of fields entirely. For example:</p>
<pre><code class="language-ds">struct Cookie;
let c = [Cookie, Cookie {}, Cookie, Cookie {}];
</code></pre>
<h2 id="mutability"><a class="header" href="#mutability">Mutability</a></h2>
<p>A field is mutable by using the <code>mut</code> keyword.</p>
<h2 id="constructor-1"><a class="header" href="#constructor-1">Constructor</a></h2>
<p>When a struct directly implements a <a href="items/functions.html#constructor">constructor method</a>, the tuple initializer is replaced by a constructor call that executes additional code and returns an instance of the struct.</p>
<h2 id="representation"><a class="header" href="#representation">Representation</a></h2>
<p>A struct constructs managed object references. More generally, all types, excluding primitives, are managed object types.</p>
<h2 id="reference-equality"><a class="header" href="#reference-equality">Reference equality</a></h2>
<p>Deriving reference equality (<code>RefEq</code>) means a struct is compared by reference when using the equality operators.</p>
<pre><code class="language-ds">#[derive(RefEq)]
struct S;
</code></pre>
<h2 id="external-struct"><a class="header" href="#external-struct">External struct</a></h2>
<p>When a struct includes the <code>extern</code> qualifier, it is an external struct imported from ActionScript.</p>
<p>An external struct may use the <code>#[actionscript]</code> attribute with the following possible key-value pairs and names:</p>
<ul>
<li><code>package = &quot;q1.q2&quot;</code>: indicates the ActionScript package that qualifies the struct. The <code>public</code> visibility is used.</li>
<li><code>name = &quot;name&quot;</code>: indicates the ActionScript property name.</li>
</ul>
<p>Example of an external struct:</p>
<pre><code class="language-ds">#[actionscript(package = &quot;com.q&quot;, name = &quot;C&quot;)]
extern struct C;
</code></pre>
<h2 id="inheritance"><a class="header" href="#inheritance">Inheritance</a></h2>
<p>A struct <code>S2</code> may inherit another struct <code>S1</code> by using a colon (<code>struct S2 : S1;</code>). In that case, <code>S1</code> must be inheritable (<code>#[inheritable]</code>) and <code>S1</code> must not be a subtype of <code>S2</code> already.</p>
<p>Cast and relationship operators are described in <a href="items/../inheritance.html">Inheritance</a>.</p>
<p>Here is an example of inheritance:</p>
<pre><code class="language-ds">use air::display::*;

struct MySprite: DisplayObject;

impl MySprite {
    fn new(self) {
        super();
    }
}
</code></pre>
<h2 id="field-default"><a class="header" href="#field-default">Field default</a></h2>
<p>A field can have a default initializer, allowing it to be omitted when constructing a struct using the struct initializer.</p>
<pre><code class="language-ds">struct S {
    x: f64 = 0.0,
}
let _ = S {};
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="enumerations"><a class="header" href="#enumerations">Enumerations</a></h1>
<blockquote>
<p><strong><sup>Syntax</sup></strong><br />
<em>Enumeration</em> :<br />
   <code>enum</code>
<a href="items/../identifiers.html">IDENTIFIER</a> 
<a href="items/generics.html"><em>GenericParams</em></a><sup>?</sup>
<a href="items/generics.html#where-clauses"><em>WhereClause</em></a><sup>?</sup>
<code>{</code> <em>EnumItems</em><sup>?</sup> <code>}</code></p>
<p><em>EnumItems</em> :<br />
   <em>EnumItem</em> ( <code>,</code> <em>EnumItem</em> )<sup>*</sup> <code>,</code><sup>?</sup></p>
<p><em>EnumItem</em> :<br />
   <em>OuterAttribute</em><sup>*</sup> <a href="items/../visibility-and-privacy.html"><em>Visibility</em></a><sup>?</sup><br />
   <a href="items/../identifiers.html">IDENTIFIER</a> ( <em>EnumItemTuple</em> | <em>EnumItemStruct</em> )<sup>?</sup>
<em>EnumItemDiscriminant</em><sup>?</sup></p>
<p><em>EnumItemTuple</em> :<br />
   <code>(</code> <a href="items/structs.html"><em>TupleFields</em></a><sup>?</sup> <code>)</code></p>
<p><em>EnumItemStruct</em> :<br />
   <code>{</code> <a href="items/structs.html"><em>StructFields</em></a><sup>?</sup> <code>}</code></p>
<p><em>EnumItemDiscriminant</em> :<br />
   <code>=</code> <a href="items/../expressions.html"><em>Expression</em></a></p>
</blockquote>
<p>An <em>enumeration</em>, also referred to as an <em>enum</em>, is a simultaneous definition of a
nominal <a href="items/../types/enum.html">enumerated type</a> as well as a set of <em>constructors</em>, that can be used
to create or pattern-match values of the corresponding enumerated type.</p>
<p>Enumerations are declared with the keyword <code>enum</code>.</p>
<p>An example of an <code>enum</code> item and its use:</p>
<pre><code class="language-ds">enum Animal {
    Dog,
    Cat,
}

let mut a: Animal = Animal::Dog;
a = Animal::Cat;
</code></pre>
<p>Enum constructors can have either named or unnamed fields:</p>
<pre><code class="language-ds">enum Animal {
    Dog(str, f64),
    Cat { name: str, weight: f64 },
}

let mut a: Animal = Animal::Dog(&quot;Cocoa&quot;, 37.2);
a = Animal::Cat { name: &quot;Spotty&quot;, weight: 2.7 };
</code></pre>
<p>In this example, <code>Cat</code> is a <em>struct-like enum variant</em>, whereas <code>Dog</code> is simply
called an enum variant.</p>
<p>An enum where no constructors contain fields are called a
<em><span id="field-less-enum">field-less enum</span></em>. For example, this is a fieldless enum:</p>
<pre><code class="language-ds">enum Fieldless {
    Tuple(),
    Struct{},
    Unit,
}
</code></pre>
<p>If a field-less enum only contains unit variants, the enum is called an
<em><span id="unit-only-enum">unit-only enum</span></em>. For example:</p>
<pre><code class="language-ds">enum Enum {
    Foo = 3,
    Bar = 2,
    Baz = 1,
}
</code></pre>
<h2 id="discriminants"><a class="header" href="#discriminants">Discriminants</a></h2>
<p>Each enum instance has a <em>discriminant</em>. The discriminant type is <code>()</code> by default. A discriminant type <code>T</code> can be specified by using <code>#[discriminant(T)]</code> and <code>T</code> must implement <code>Eq | PartialEq</code>; for example:</p>
<pre><code class="language-ds">#[discriminant(str)]
enum E {
    Foo = &quot;foo&quot;,
    Bar(f64) = &quot;bar&quot;,
}
</code></pre>
<p>A discriminant value is specified by using an <code>=</code> assignment following the variant. If the discriminant type is any other than <code>()</code>, then all variants must specify their discriminant.</p>
<p>Variants with duplicate discriminant are not allowed.</p>
<h3 id="accessing-discriminant"><a class="header" href="#accessing-discriminant">Accessing discriminant</a></h3>
<p>The discriminant of an enumeration can be accessed via the <code>Into&lt;D&gt;</code> trait, where <code>D</code> is the discriminant type, if the enum derives <code>PartialEq</code>. <code>Into&lt;D&gt;</code> is not implemented if <code>PartialEq</code> is not derived.</p>
<p>Example:</p>
<pre><code class="language-ds">#[discriminant(str)]
#[derive(PartialEq)]
enum E {
    X = &quot;x&quot;,
    Y = &quot;y&quot;,
}
assert_eq!(&quot;x&quot;, E::X.into());
</code></pre>
<h3 id="retrieving-variant-from-discriminant"><a class="header" href="#retrieving-variant-from-discriminant">Retrieving variant from discriminant</a></h3>
<p>Retrieving a variant from a discriminant value is possible for unit-only enums. <code>TryFrom&lt;D&gt;</code> is implemented for unit-only <code>PartialEq</code> enums where <code>D</code> is the discriminant type.</p>
<pre><code class="language-ds">#[discriminant(str)]
#[derive(PartialEq)]
enum E {
    X = &quot;x&quot;,
    Y = &quot;y&quot;,
}
assert_eq!(Ok(E::X), E::try_from(&quot;x&quot;));
</code></pre>
<h2 id="variant-visibility"><a class="header" href="#variant-visibility">Variant visibility</a></h2>
<p>Enum variants syntactically allow a <a href="items/../visibility-and-privacy.html"><em>Visibility</em></a> annotation, but this is
rejected when the enum is validated. This allows items to be parsed with a
unified syntax across different contexts where they are used.</p>
<pre><code class="language-ds">macro mac_variant {
    ($vis:vis $name:ident) =&gt; {
        enum $name {
            $vis Unit,

            $vis Tuple(f64, u32),

            $vis Struct { f: f64 },
        }
    }
}

// Empty `vis` is allowed.
mac_variant! { E }

// This is allowed, since it is removed before being validated.
#[cfg(FALSE)]
enum E {
    pub U,
    pub(crate) T(u32),
    pub(super) T { f: str }
}
</code></pre>
<h2 id="representation-1"><a class="header" href="#representation-1">Representation</a></h2>
<p>Enum variants construct managed object references. More generally, all types, excluding primitives, are managed object types.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="constant-items"><a class="header" href="#constant-items">Constant items</a></h1>
<blockquote>
<p><strong><sup>Syntax</sup></strong><br />
<em>ConstantItem</em> :<br />
   <code>const</code> ( <a href="items/../identifiers.html">IDENTIFIER</a> | <code>_</code> ) ( <code>:</code> <a href="items/../types.html#type-expressions"><em>Type</em></a> )<sup>?</sup> ( <code>=</code> <a href="items/../expressions.html"><em>Expression</em></a> )<sup>?</sup> <code>;</code></p>
</blockquote>
<p>The meaning of a <em>constant item</em> depends on the context it is used or attributes specified:</p>
<ul>
<li>If it has the attribute <code>#[inline]</code>, it is always an <em>inlined constant</em>, independent from the context it appears in.</li>
<li>If it appears inside a module, it is a static item.</li>
<li>If it appears inside a trait or inside an implementation for a trait, it is an <em>inlined constant</em>.</li>
<li>If it appears inside a function, it is a let statement.</li>
</ul>
<p>If the constant item is an inlined constant, its expression is expanded wherever used, similiar to a function call.</p>
<p>Examples:</p>
<pre><code class="language-ds">const MAX: f64 = 10_000.0;

fn f() {
    let x = 10;
    const y = x * x;
}

trait Tr {
    const F;
}

static X: f64 = 0.0

#[inline]
const COMPUTED_X: f64 = X * X;
</code></pre>
<p>A constant item can omit its type only when it is a let statement.</p>
<h2 id="unnamed-constant"><a class="header" href="#unnamed-constant">Unnamed constant</a></h2>
<p>Unlike an <a href="items/../items/associated-items.html#associated-constants">associated constant</a>, a <a href="items/../glossary.html#free-item">free</a> constant may be unnamed by using
an underscore instead of the name. For example:</p>
<pre><code class="language-ds">const _: () =  { struct _SameNameTwice; };

// OK although it is the same name as above:
const _: () =  { struct _SameNameTwice; };
</code></pre>
<p>As with <a href="items/use-declarations.html#underscore-imports">underscore imports</a>, macros may safely emit the same unnamed constant in
the same scope more than once. For example, the following should not produce an error:</p>
<pre><code class="language-ds">macro m {
    ($item: item) =&gt; { $item $item }
}

m!(const _: () = (););
// This expands to:
// const _: () = ();
// const _: () = ();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="static-items"><a class="header" href="#static-items">Static items</a></h1>
<blockquote>
<p><strong><sup>Syntax</sup></strong><br />
<em>StaticItem</em> :<br />
   <code>static</code> <code>mut</code><sup>?</sup> <a href="items/../identifiers.html">IDENTIFIER</a> <code>:</code> <a href="items/../types.html#type-expressions"><em>Type</em></a>
( <code>=</code> <a href="items/../expressions.html"><em>Expression</em></a> )<sup>?</sup> <code>;</code></p>
</blockquote>
<p>A <em>static item</em> is a lazily-evaluated variable whose memory location is global to the program and spans the entire lifetime of the program.</p>
<pre><code class="language-ds">static X: Option&lt;f64&gt; = None;
</code></pre>
<p>Static items cannot be cyclic, therefore a directed acyclic graph covering dependency of all static items is built during code analysis.</p>
<p>It is a compile error if the initializer expression is omitted.</p>
<h2 id="statics--generics"><a class="header" href="#statics--generics">Statics &amp; generics</a></h2>
<p>A static item defined in a generic scope (for example in a blanket or default
implementation) will result in exactly one static item being defined, as if
the static definition was pulled out of the current scope into the module.
There will <em>not</em> be one item per monomorphization.</p>
<p>This code:</p>
<pre><code class="language-ds">trait Tr {
    fn default_impl() {
        static COUNTER: u32 = 0;
        print!(&quot;default_impl: counter was {COUNTER}&quot;);
        COUNTER += 1;
    }

    fn blanket_impl();
}

struct Ty1 {}
struct Ty2 {}

impl&lt;T&gt; Tr for T {
    fn blanket_impl() {
        static COUNTER: u32 = 0;
        print!(&quot;blanket_impl: counter was {COUNTER}&quot;);
        COUNTER += 1;
    }
}

fn main() {
    &lt;Ty1 as Tr&gt;::default_impl();
    &lt;Ty2 as Tr&gt;::default_impl();
    &lt;Ty1 as Tr&gt;::blanket_impl();
    &lt;Ty2 as Tr&gt;::blanket_impl();
}
</code></pre>
<p>prints</p>
<pre><code class="language-text">default_impl: counter was 0
default_impl: counter was 1
blanket_impl: counter was 0
blanket_impl: counter was 1
</code></pre>
<h2 id="mutable-statics"><a class="header" href="#mutable-statics">Mutable statics</a></h2>
<p>If a static item is declared with the <code>mut</code> keyword, then it is allowed to be
modified by the program.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="traits"><a class="header" href="#traits">Traits</a></h1>
<blockquote>
<p><strong><sup>Syntax</sup></strong><br />
<em>Trait</em> :<br />
   <em>TraitQualifiers</em><sup>?</sup> <code>trait</code> <a href="items/../identifiers.html">IDENTIFIER</a> 
<a href="items/generics.html"><em>GenericParams</em></a><sup>?</sup>
( <code>:</code> <a href="items/../trait-bounds.html"><em>TypeParamBounds</em></a><sup>?</sup> )<sup>?</sup>
<a href="items/generics.html#where-clauses"><em>WhereClause</em></a><sup>?</sup> <code>{</code><br />
     <a href="items/../attributes.html"><em>InnerAttribute</em></a><sup>*</sup><br />
     <a href="items/associated-items.html"><em>AssociatedItem</em></a><sup>*</sup><br />
   <code>}</code></p>
<p><em>TraitQualifiers</em> :<br />
   <code>extern</code><sup>?</sup></p>
</blockquote>
<p>A <em>trait</em> describes an abstract interface type that other types can implement. This
interface consists of <a href="items/associated-items.html">associated items</a>, which come in three varieties:</p>
<ul>
<li><a href="items/associated-items.html#associated-functions-and-methods">functions</a></li>
<li><a href="items/associated-items.html#associated-types">types</a></li>
<li><a href="items/associated-items.html#associated-constants">constants</a></li>
</ul>
<p>All traits define an implicit type parameter <code>Self</code> that refers to &quot;the type
that is implementing this interface&quot;. Traits may also contain additional type
parameters. These type parameters, including <code>Self</code>, may be constrained by
other traits and so forth <a href="items/generics.html">as usual</a>.</p>
<p>Traits are implemented for specific types through separate <a href="items/implementations.html">implementations</a>.</p>
<p>Trait functions may omit the function body by replacing it with a semicolon.
This indicates that the implementation must define the function. If the trait
function defines a body, this definition acts as a default for any
implementation which does not override it. Similarly, associated constants may
omit the equals sign and expression to indicate implementations must define
the constant value. Associated types must never define the type, the type may
only be specified in an implementation.</p>
<pre><code class="language-ds">// Examples of associated trait items with and without definitions.
trait Example {
    const CONST_NO_DEFAULT: i32;
    const CONST_WITH_DEFAULT: i32 = 99;
    type TypeNoDefault;
    fn method_without_default(self);
    fn method_with_default(self) {}
}
</code></pre>
<p>Trait functions are not allowed to be <a href="items/functions.html#async-functions"><code>async</code></a> or <a href="items/functions.html#external-functions"><code>extern</code></a>.</p>
<h2 id="trait-objects"><a class="header" href="#trait-objects">Trait objects</a></h2>
<p>A trait can be used normally as an opaque type.</p>
<pre><code class="language-ds">trait Tr {}
struct S;
impl Tr for S {}

fn main() {
    let o: S = S;
    let o: Tr = S;
}
</code></pre>
<h2 id="trait-bounds"><a class="header" href="#trait-bounds">Trait bounds</a></h2>
<p>Generic items may use traits as <a href="items/../trait-bounds.html">bounds</a> on their type parameters.</p>
<h2 id="generic-traits"><a class="header" href="#generic-traits">Generic Traits</a></h2>
<p>Type parameters can be specified for a trait to make it generic. These appear
after the trait name, using the same syntax used in <a href="items/functions.html#generic-functions">generic functions</a>.</p>
<pre><code class="language-ds">trait Seq&lt;T&gt; {
    fn len(self) -&gt; u32;
    fn elt_at(self, n: u32) -&gt; T;
}
</code></pre>
<h2 id="supertraits"><a class="header" href="#supertraits">Supertraits</a></h2>
<p><strong>Supertraits</strong> are traits that are required to be implemented for a type to
implement a specific trait. Furthermore, anywhere a <a href="items/generics.html">generic</a> is bounded by a trait, it has access to the associated items of its supertraits.</p>
<p>Supertraits are declared by trait bounds on the <code>Self</code> type of a trait and
transitively the supertraits of the traits declared in those trait bounds. It is
an error for a trait to be its own supertrait.</p>
<p>The trait with a supertrait is called a <strong>subtrait</strong> of its supertrait.</p>
<p>The following is an example of declaring <code>Shape</code> to be a supertrait of <code>Circle</code>.</p>
<pre><code class="language-ds">trait Shape { fn area(self) -&gt; f64; }
trait Circle : Shape { fn radius(self) -&gt; f64; }
</code></pre>
<p>And the following is the same example, except using <a href="items/generics.html#where-clauses">where clauses</a>.</p>
<pre><code class="language-ds">trait Shape { fn area(self) -&gt; f64; }
trait Circle where Self: Shape { fn radius(self) -&gt; f64; }
</code></pre>
<p>This next example gives <code>radius</code> a default implementation using the <code>area</code>
function from <code>Shape</code>.</p>
<pre><code class="language-ds">trait Circle where Self: Shape {
    fn radius(self) -&gt; f64 {
        // A = pi * r^2
        // so algebraically,
        // r = sqrt(A / pi)
        (self.area() / PI).sqrt()
    }
}
</code></pre>
<p>This next example calls a supertrait method on a generic parameter.</p>
<pre><code class="language-ds">fn print_area_and_radius&lt;C: Circle&gt;(c: C) {
    // Here we call the area method from the supertrait `Shape` of `Circle`.
    print!(&quot;Area: {}&quot;, c.area());
    print!(&quot;Radius: {}&quot;, c.radius());
}
</code></pre>
<h2 id="parameter-patterns"><a class="header" href="#parameter-patterns">Parameter patterns</a></h2>
<p>Function or method declarations without a body only allow <a href="items/../identifiers.html">IDENTIFIER</a> or
<code>_</code> <a href="items/../patterns.html#wildcard-pattern">wild card</a> patterns. <code>mut</code> <a href="items/../identifiers.html">IDENTIFIER</a> is not allowed.</p>
<p>The kinds of patterns for parameters is limited to one of the following:</p>
<ul>
<li><a href="items/../identifiers.html">IDENTIFIER</a></li>
<li><code>mut</code> <a href="items/../identifiers.html">IDENTIFIER</a></li>
<li><a href="items/../patterns.html#wildcard-pattern"><code>_</code></a></li>
</ul>
<p>All irrefutable patterns are allowed as long as there
is a body. Without a body, the limitations listed above are still in effect.</p>
<pre><code class="language-ds">trait T {
    fn f1((a, b): (i32, i32)) {}
    fn f2(_: (i32, i32));  // Cannot use tuple pattern without a body.
}
</code></pre>
<h2 id="item-visibility"><a class="header" href="#item-visibility">Item visibility</a></h2>
<p>Trait items syntactically allow a <a href="items/../visibility-and-privacy.html"><em>Visibility</em></a> annotation, but this is
rejected when the trait is validated. This allows items to be parsed with a
unified syntax across different contexts where they are used. As an example,
an empty <code>vis</code> macro fragment specifier can be used for trait items, where the
macro rule may be used in other situations where visibility is allowed.</p>
<pre><code class="language-ds">macro create_method {
    ($vis:vis $name:ident) =&gt; {
        $vis fn $name(self) {}
    };
}

trait T1 {
    // Empty `vis` is allowed.
    create_method! { method_of_t1 }
}

struct S;

impl S {
    // Visibility is allowed here.
    create_method! { pub method_of_s }
}

impl T1 for S {}

fn main() {
    let s = S;
    s.method_of_t1();
    s.method_of_s();
}
</code></pre>
<h2 id="external-trait"><a class="header" href="#external-trait">External trait</a></h2>
<p>When a trait includes the <code>extern</code> qualifier, it is an external interface imported from ActionScript.</p>
<p>An external trait may use the <code>#[actionscript]</code> attribute with the following possible key-value pairs and names:</p>
<ul>
<li><code>package = &quot;q1.q2&quot;</code>: indicates the ActionScript package that qualifies the interface. The <code>public</code> visibility is used.</li>
<li><code>name = &quot;name&quot;</code>: indicates the ActionScript property name.</li>
</ul>
<p>Example of an external trait:</p>
<pre><code class="language-ds">#[actionscript(package = &quot;com.q&quot;, name = &quot;Itrfc&quot;)]
extern trait Tr;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="implementations"><a class="header" href="#implementations">Implementations</a></h1>
<blockquote>
<p><strong><sup>Syntax</sup></strong><br />
<em>Implementation</em> :<br />
   <em>InherentImpl</em> | <em>TraitImpl</em></p>
<p><em>InherentImpl</em> :<br />
   <code>impl</code> <a href="items/generics.html"><em>GenericParams</em></a><sup>?</sup> <a href="items/../types.html#type-expressions"><em>Type</em></a> <a href="items/generics.html#where-clauses"><em>WhereClause</em></a><sup>?</sup> <code>{</code><br />
      <a href="items/../attributes.html"><em>InnerAttribute</em></a><sup>*</sup><br />
      <a href="items/associated-items.html"><em>AssociatedItem</em></a><sup>*</sup><br />
   <code>}</code></p>
<p><em>TraitImpl</em> :<br />
   <code>impl</code> <a href="items/generics.html"><em>GenericParams</em></a><sup>?</sup>
<a href="items/../paths.html#paths-in-types"><em>TypePath</em></a> <code>for</code> <a href="items/../types.html#type-expressions"><em>Type</em></a><br />
   <a href="items/generics.html#where-clauses"><em>WhereClause</em></a><sup>?</sup><br />
   <code>{</code><br />
      <a href="items/../attributes.html"><em>InnerAttribute</em></a><sup>*</sup><br />
      <a href="items/associated-items.html"><em>AssociatedItem</em></a><sup>*</sup><br />
   <code>}</code></p>
</blockquote>
<p>An <em>implementation</em> is an item that associates items with an <em>implementing type</em>.
Implementations are defined with the keyword <code>impl</code> and contain functions
that belong to an instance of the type that is being implemented or to the
type statically.</p>
<p>There are two types of implementations:</p>
<ul>
<li>inherent implementations</li>
<li><a href="items/traits.html">trait</a> implementations</li>
</ul>
<h2 id="inherent-implementations"><a class="header" href="#inherent-implementations">Inherent Implementations</a></h2>
<p>An inherent implementation is defined as the sequence of the <code>impl</code> keyword,
generic type declarations, a path to a nominal type, a where clause, and a
bracketed set of associable items.</p>
<p>The nominal type is called the <em>implementing type</em> and the associable items are
the <em>associated items</em> to the implementing type.</p>
<p>Inherent implementations associate the contained items to the
implementing type.  Inherent implementations can contain <a href="items/associated-items.html#associated-functions-and-methods">associated
functions</a> (including <a href="items/associated-items.html#methods">methods</a>) and <a href="items/associated-items.html#associated-constants">associated constants</a>. They cannot
contain associated type aliases.</p>
<p>The <a href="items/../paths.html">path</a> to an associated item is any path to the implementing type,
followed by the associated item's identifier as the final path
component.</p>
<p>A type can also have multiple inherent implementations. An implementing type
must be defined within the same crate as the original type definition.</p>
<pre><code class="language-ds">pub mod color {
    pub struct Color(pub u32, pub u32, pub u32);

    impl Color {
        pub const WHITE: Color = Color(255, 255, 255);
    }
}

mod values {
    use super::color::Color;
    impl Color {
        pub fn red() -&gt; Color {
            Color(255, 0, 0)
        }
    }
}

pub use self::color::Color;
fn main() {
    // Actual path to the implementing type and impl in the same module.
    color::Color::WHITE;

    // Impl blocks in different modules are still accessed through a path to the type.
    color::Color::red();

    // Re-exported paths to the implementing type also work.
    Color::red();

    // Does not work, because use in `values` is not pub.
    // values::Color::red();
}
</code></pre>
<h2 id="trait-implementations"><a class="header" href="#trait-implementations">Trait Implementations</a></h2>
<p>A <em>trait implementation</em> is defined like an inherent implementation except that
the optional generic type declarations are followed by a <a href="items/traits.html">trait</a>, followed
by the keyword <code>for</code>, followed by a path to a nominal type.</p>
<!-- To understand this, you have to back-reference to the previous section. :( -->
<p>The trait is known as the <em>implemented trait</em>. The implementing type
implements the implemented trait.</p>
<p>A trait implementation must define all non-default associated items declared
by the implemented trait, may redefine default associated items defined by the
implemented trait, and cannot define any other items.</p>
<p>The path to the associated items is <code>&lt;</code> followed by a path to the implementing
type followed by <code>as</code> followed by a path to the trait followed by <code>&gt;</code> as a path
component followed by the associated item's path component.</p>
<pre><code class="language-ds">struct Circle {
    radius: f64,
    center: Point,
}

impl Shape for Circle {
    fn draw(self, s: Surface) { do_draw_circle(s, self); }
    fn bounding_box(self) -&gt; BoundingBox {
        let r = self.radius;
        BoundingBox {
            x: self.center.x - r,
            y: self.center.y - r,
            width: 2.0 * r,
            height: 2.0 * r,
        }
    }
}
</code></pre>
<h3 id="trait-implementation-coherence"><a class="header" href="#trait-implementation-coherence">Trait Implementation Coherence</a></h3>
<p>A trait implementation is considered incoherent if either the orphan rules check fails
or there are overlapping implementation instances.</p>
<p>Two trait implementations overlap when there is a non-empty intersection of the
traits the implementation is for, the implementations can be instantiated with
the same type. <!-- This is probably wrong? Source: No two implementations can
be instantiable with the same set of types for the input type parameters. --></p>
<h4 id="orphan-rules"><a class="header" href="#orphan-rules">Orphan rules</a></h4>
<p>Given <code>impl&lt;P1..=Pn&gt; Trait&lt;T1..=Tn&gt; for T0</code>, an <code>impl</code> is valid only if at
least one of the following is true:</p>
<ul>
<li><code>Trait</code> is a <a href="items/../glossary.html#local-trait">local trait</a></li>
<li>All of
<ul>
<li>At least one of the types <code>T0..=Tn</code> must be a <a href="items/../glossary.html#local-type">local type</a>. Let <code>Ti</code> be the
first such type.</li>
<li>No <a href="items/../glossary.html#uncovered-type">uncovered type</a> parameters <code>P1..=Pn</code> may appear in <code>T0..Ti</code> (excluding
<code>Ti</code>)</li>
</ul>
</li>
</ul>
<h2 id="generic-implementations"><a class="header" href="#generic-implementations">Generic Implementations</a></h2>
<p>An implementation can take <a href="items/generics.html">generic parameters</a>, which can be used in the rest
of the implementation. Implementation parameters are written directly after the
<code>impl</code> keyword.</p>
<pre><code class="language-ds">impl&lt;T&gt; Seq&lt;T&gt; for [T] {
    /* ... */
}
impl Seq&lt;bool&gt; for u32 {
    /* Treat the integer as a sequence of bits */
}
</code></pre>
<p>Generic parameters <em>constrain</em> an implementation if the parameter appears at
least once in one of:</p>
<ul>
<li>The implemented trait, if it has one</li>
<li>The implementing type</li>
<li>As an <a href="items/associated-items.html#associated-types">associated type</a> in the <a href="items/../trait-bounds.html">bounds</a> of a type that contains another
parameter that constrains the implementation</li>
</ul>
<p>Type parameters must always constrain the implementation.</p>
<p>Examples of constraining situations:</p>
<pre><code class="language-ds">// T constrains by being an argument to GenericTrait.
impl&lt;T&gt; GenericTrait&lt;T&gt; for i32 { /* ... */ }

// T constrains by being an argument to GenericStruct
impl&lt;T&gt; Trait for GenericStruct&lt;T&gt; { /* ... */ }

// T constrains by being in an associated type in a bound for type `U` which is
// itself a generic parameter constraining the trait.
impl&lt;T, U&gt; GenericTrait&lt;U&gt; for u32 where U: HasAssocType&lt;Ty = T&gt; { /* ... */ }

// Like previous, except the type is `(U, i32)`. `U` appears inside the type
// that includes `T`, and is not the type itself.
impl&lt;T, U&gt; GenericStruct&lt;U&gt; where (U, i32): HasAssocType&lt;Ty = T&gt; { /* ... */ }
</code></pre>
<p>Examples of non-constraining situations:</p>
<pre><code class="language-ds">// The rest of these are errors, since they have type or const parameters that
// do not constrain.

// T does not constrain since it does not appear at all.
impl&lt;T&gt; Struct { /* ... */ }

// Usage of T inside the implementation does not constrain the impl.
impl&lt;T&gt; Struct {
    fn uses_t(t: T) { /* ... */ }
}

// T is used as an associated type in the bounds for U, but U does not constrain.
impl&lt;T, U&gt; Struct where U: HasAssocType&lt;Ty = T&gt; { /* ... */ }

// T is used in the bounds, but not as an associated type, so it does not constrain.
impl&lt;T, U&gt; GenericTrait&lt;U&gt; for u32 where U: GenericTrait&lt;T&gt; {}
</code></pre>
<h2 id="attributes-on-implementations"><a class="header" href="#attributes-on-implementations">Attributes on Implementations</a></h2>
<p>Implementations may contain outer <a href="items/../attributes.html">attributes</a> before the <code>impl</code> keyword and
inner <a href="items/../attributes.html">attributes</a> inside the brackets that contain the associated items. Inner
attributes must come before any associated items. The attributes that have
meaning here are <a href="items/../conditional-compilation.html"><code>cfg</code></a>, <a href="items/../attributes/diagnostics.html#the-deprecated-attribute"><code>deprecated</code></a>, <a href="items/../../dsdoc/the-doc-attribute.html"><code>doc</code></a>, and <a href="items/../attributes/diagnostics.html#lint-check-attributes">the lint check
attributes</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="generic-parameters"><a class="header" href="#generic-parameters">Generic parameters</a></h1>
<blockquote>
<p><strong><sup>Syntax</sup></strong><br />
<em>GenericParams</em> :<br />
      <code>&lt;</code> <code>&gt;</code><br />
    | <code>&lt;</code> (<em>GenericParam</em> <code>,</code>)<sup>*</sup> <em>GenericParam</em> <code>,</code><sup>?</sup> <code>&gt;</code></p>
<p><em>GenericParam</em> :<br />
   <a href="items/../attributes.html"><em>OuterAttribute</em></a><sup>*</sup> <em>TypeParam</em></p>
<p><em>TypeParam</em> :<br />
   <a href="items/../identifiers.html">IDENTIFIER</a>( <code>:</code> <a href="items/../trait-bounds.html"><em>TypeParamBounds</em></a><sup>?</sup> )<sup>?</sup> ( <code>=</code> <a href="items/../types.html#type-expressions"><em>Type</em></a> )<sup>?</sup></p>
</blockquote>
<p><a href="items/functions.html">Functions</a>, <a href="items/type-aliases.html">type aliases</a>, <a href="items/structs.html">structs</a>, <a href="items/enumerations.html">enumerations</a>, <a href="items/traits.html">traits</a>, and
<a href="items/implementations.html">implementations</a> may be <em>parameterized</em> by types. These
parameters are listed in angle <span class="parenthetical">brackets (<code>&lt;...&gt;</code>)</span>,
usually immediately after the name of the item and before its definition. For
implementations, which don't have a name, they come directly after <code>impl</code>.</p>
<p>Some examples of items with type parameters:</p>
<pre><code class="language-ds">fn foo&lt;T&gt;() {}
trait A&lt;U&gt; {}
struct S&lt;T&gt; { array: [T] }
</code></pre>
<p>Generic parameters are in scope within the item definition where they are
declared. They are not in scope for items declared within the body of a
function as described in <a href="items/../statements.html#item-declarations">item declarations</a>.</p>
<p><a href="items/../types/array.html">Arrays</a>, <a href="items/../types/tuple.html">tuples</a> and [function types] have type parameters as well, but are not
referred to with path syntax.</p>
<h2 id="where-clauses"><a class="header" href="#where-clauses">Where clauses</a></h2>
<blockquote>
<p><strong><sup>Syntax</sup></strong><br />
<em>WhereClause</em> :<br />
   <code>where</code> ( <em>WhereClauseItem</em> <code>,</code> )<sup>*</sup> <em>WhereClauseItem</em> <sup>?</sup></p>
<p><em>WhereClauseItem</em> :<br />
      <em>TypeBoundWhereClauseItem</em></p>
<p><em>TypeBoundWhereClauseItem</em> :<br />
   <a href="items/../types.html#type-expressions"><em>Type</em></a> <code>:</code> <a href="items/../trait-bounds.html"><em>TypeParamBounds</em></a><sup>?</sup></p>
</blockquote>
<p><em>Where clauses</em> provide another way to specify bounds on type parameters as well as a way to specify bounds on types that aren't type
parameters.</p>
<h2 id="attributes"><a class="header" href="#attributes">Attributes</a></h2>
<p>Generic type parameters allow <a href="items/../attributes.html">attributes</a> on them. There are no
built-in attributes that do anything in this position, although custom derive
attributes may give meaning to it.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="associated-items"><a class="header" href="#associated-items">Associated Items</a></h1>
<blockquote>
<p><strong><sup>Syntax</sup></strong><br />
<em>AssociatedItem</em> :<br />
   <a href="items/../attributes.html"><em>OuterAttribute</em></a><sup>*</sup> (<br />
         <a href="items/../macros.html#macro-invocation"><em>MacroInvocationSemi</em></a><br />
      | ( <a href="items/../visibility-and-privacy.html"><em>Visibility</em></a><sup>?</sup> ( <a href="items/type-aliases.html"><em>TypeAlias</em></a> | <a href="items/constant-items.html"><em>ConstantItem</em></a> | <a href="items/functions.html"><em>Function</em></a> ) )<br />
   )</p>
</blockquote>
<p><em>Associated Items</em> are the items declared in <a href="items/traits.html">traits</a> or defined in
<a href="items/implementations.html">implementations</a>. They are called this because they are defined on an associate
type — the type in the implementation. They are a subset of the kinds of
items you can declare in a module. Specifically, there are <a href="items/associated-items.html#associated-functions-and-methods">associated
functions</a> (including methods), <a href="items/associated-items.html#associated-types">associated types</a>, and <a href="items/associated-items.html#associated-constants">associated constants</a>.</p>
<p>Associated items are useful when the associated item logically is related to the
associating item. For example, the <code>is_some</code> method on <code>Option</code> is intrinsically
related to Options, so should be associated.</p>
<p>Every associated item kind comes in two varieties: definitions that contain the
actual implementation and declarations that declare signatures for
definitions.</p>
<p>It is the declarations that make up the contract of traits and what is available
on generic types.</p>
<h2 id="associated-functions-and-methods"><a class="header" href="#associated-functions-and-methods">Associated functions and methods</a></h2>
<p><em>Associated functions</em> are <a href="items/functions.html">functions</a> associated with a type.</p>
<p>An <em>associated function declaration</em> declares a signature for an associated
function definition. It is written as a function item, except the
function body is replaced with a <code>;</code>.</p>
<p>The identifier is the name of the function. The generics, parameter list,
return type, and where clause of the associated function must be the same as the
associated function declarations's.</p>
<p>An <em>associated function definition</em> defines a function associated with another
type. It is written the same as a <a href="items/../types/function-item.html">function item</a>.</p>
<p>An example of an associated function:</p>
<pre><code class="language-ds">struct Struct;

impl Struct {
    fn f() {} // function
}
</code></pre>
<p>When the associated function is declared on a trait, the function can also be
called with a <a href="items/../paths.html">path</a> that is a path to the trait appended by the name of the
trait. When this happens, it is substituted for <code>&lt;_ as Trait&gt;::function_name</code>.</p>
<pre><code class="language-ds">trait Num {
    fn from_i32(n: i32) -&gt; Self;
}

impl Num for f64 {
    fn from_i32(n: i32) -&gt; f64 { n as f64 }
}

// These 4 are all equivalent in this case.
let _: f64 = Num::from_i32(42);
let _: f64 = &lt;_ as Num&gt;::from_i32(42);
let _: f64 = &lt;f64 as Num&gt;::from_i32(42);
let _: f64 = f64::from_i32(42);
</code></pre>
<h3 id="methods"><a class="header" href="#methods">Methods</a></h3>
<p>Associated functions whose first parameter is named <code>self</code> are called <em>methods</em>
and may be invoked using the <a href="items/../expressions/method-call-expr.html">method call operator</a>, for example, <code>x.foo()</code>, as
well as the usual function call notation.</p>
<p>If the type of the <code>self</code> parameter is specified, it is limited to <code>Self</code>.</p>
<p>Shorthand syntax can be used without specifying a type, which have the
following equivalents:</p>
<div class="table-wrapper"><table><thead><tr><th>Shorthand</th><th>Equivalent</th></tr></thead><tbody>
<tr><td><code>self</code></td><td><code>self: Self</code></td></tr>
</tbody></table>
</div>
<p>As an example of methods on a trait, consider the following:</p>
<pre><code class="language-ds">trait Shape {
    fn draw(self, surface: Surface);
    fn bounding_box(self) -&gt; BoundingBox;
}
</code></pre>
<p>This defines a trait with two methods. All values that have <a href="items/implementations.html">implementations</a>
of this trait while the trait is in scope can have their <code>draw</code> and
<code>bounding_box</code> methods called.</p>
<pre><code class="language-ds">struct Circle {
    // ...
}

impl Shape for Circle {
    // ...
}

let circle_shape = Circle();
let bounding_box = circle_shape.bounding_box();
</code></pre>
<h4 id="attributes-on-method-parameters"><a class="header" href="#attributes-on-method-parameters">Attributes on method parameters</a></h4>
<p>Attributes on method parameters follow the same rules and restrictions as
<a href="items/functions.html#attributes-on-function-parameters">regular function parameters</a>.</p>
<h2 id="associated-types"><a class="header" href="#associated-types">Associated Types</a></h2>
<p><em>Associated types</em> are <a href="items/type-aliases.html">type aliases</a> associated with another type. Associated
types cannot be defined in <a href="items/implementations.html#inherent-implementations">inherent implementations</a> nor can they be given a
default implementation in traits.</p>
<p>An <em>associated type declaration</em> declares a signature for associated type
definitions. It is written in one of the following forms, where <code>Assoc</code> is the
name of the associated type, <code>Params</code> is a comma-separated list of type parameters, <code>Bounds</code> is a plus-separated list of trait bounds
that the associated type must meet, and <code>WhereBounds</code> is a comma-separated list
of bounds that the parameters must meet:</p>
<!-- ignore: illustrative example forms -->
<pre><code class="language-ds ignore">type Assoc;
type Assoc: Bounds;
type Assoc&lt;Params&gt;;
type Assoc&lt;Params&gt;: Bounds;
type Assoc&lt;Params&gt; where WhereBounds;
type Assoc&lt;Params&gt;: Bounds where WhereBounds;
</code></pre>
<p>The identifier is the name of the declared type alias. The optional trait bounds
must be fulfilled by the implementations of the type alias.</p>
<p>An <em>associated type definition</em> defines a type alias for the implementation
of a trait on a type. They are written similarly to an <em>associated type declaration</em>,
but cannot contain <code>Bounds</code>, but instead must contain a <code>Type</code>:</p>
<!-- ignore: illustrative example forms -->
<pre><code class="language-ds ignore">type Assoc = Type;
type Assoc&lt;Params&gt; = Type; // the type `Type` here may reference `Params`
type Assoc&lt;Params&gt; = Type where WhereBounds;
</code></pre>
<p>If a type <code>Item</code> has an associated type <code>Assoc</code> from a trait <code>Trait</code>, then
<code>&lt;Item as Trait&gt;::Assoc</code> is a type that is an alias of the type specified in the
associated type definition. Furthermore, if <code>Item</code> is a type parameter, then
<code>Item::Assoc</code> can be used in type parameters.</p>
<p>Associated types may include <a href="items/generics.html">generic parameters</a> and <a href="items/generics.html#where-clauses">where clauses</a>; these are
often referred to as <em>generic associated types</em>, or <em>GATs</em>. If the type <code>Thing</code>
has an associated type <code>Item</code> from a trait <code>Trait</code> with the generics <code>&lt;T&gt;</code> , the
type can be named like <code>&lt;Thing as Trait&gt;::Item&lt;str&gt;</code>. In this case, <code>str</code> will be used wherever <code>T</code> appears in the associated
type definitions on impls.</p>
<pre><code class="language-ds">trait AssociatedType {
    // Associated type declaration
    type Assoc;
}

struct Struct;

struct OtherStruct;

impl AssociatedType for Struct {
    // Associated type definition
    type Assoc = OtherStruct;
}

impl OtherStruct {
    fn new(self) {}
}

fn main() {
    // Usage of the associated type to refer to OtherStruct as &lt;Struct as AssociatedType&gt;::Assoc
    let _other_struct: OtherStruct = &lt;Struct as AssociatedType&gt;::Assoc();
}
</code></pre>
<h3 id="associated-types-container-example"><a class="header" href="#associated-types-container-example">Associated Types Container Example</a></h3>
<p>Consider the following example of a <code>Container</code> trait. Notice that the type is
available for use in the method signatures:</p>
<pre><code class="language-ds">trait Container {
    type E;
    fn empty() -&gt; Self;
    fn insert(self, elem: Self::E);
}
</code></pre>
<p>In order for a type to implement this trait, it must not only provide
implementations for every method, but it must specify the type <code>E</code>. Here's an
implementation of <code>Container</code> for the built-in array type:</p>
<pre><code class="language-ds">impl&lt;T&gt; Container for [T] {
    type E = T;
    fn empty() -&gt; [T] { [] }
    fn insert(self, x: T) { self.push(x); }
}
</code></pre>
<h3 id="relationship-between-bounds-and-wherebounds"><a class="header" href="#relationship-between-bounds-and-wherebounds">Relationship between <code>Bounds</code> and <code>WhereBounds</code></a></h3>
<p>In this example:</p>
<pre><code class="language-ds">trait Example {
    type Output&lt;T&gt;: Ord where T: Debug;
}
</code></pre>
<p>Given a reference to the associated type like <code>&lt;X as Example&gt;::Output&lt;Y&gt;</code>, the associated type itself must be <code>Ord</code>, and the type <code>Y</code> must be <code>Debug</code>.</p>
<h3 id="required-where-clauses-on-generic-associated-types"><a class="header" href="#required-where-clauses-on-generic-associated-types">Required where clauses on generic associated types</a></h3>
<p>Generic associated type declarations on traits currently may require a list of
where clauses, dependent on functions in the trait and how the GAT is used. These
rules may be loosened in the future; updates can be found <a href="https://ds-lang.github.io/generic-associated-types-initiative/explainer/required_bounds.html">on the generic
associated types initiative repository</a>.</p>
<p>In a few words, these where clauses are required in order to maximize the allowed
definitions of the associated type in impls. To do this, any clauses that <em>can be
proven to hold</em> on functions (using the parameters of the function or trait)
where a GAT appears as an input or output must also be written on the GAT itself.</p>
<p>When there are multiple functions in a trait that use the GAT, then the
<em>intersection</em> of the bounds from the different functions are used, rather than
the union.</p>
<p>The bounds on associated types also propagate required where clauses.</p>
<pre><code class="language-ds">trait Iterable {
    type Item&lt;'a&gt; where Self: 'a;
    type Iterator&lt;'a&gt;: Iterator&lt;Item = Self::Item&lt;'a&gt;&gt; where Self: 'a;
    fn iter&lt;'a&gt;(&amp;'a self) -&gt; Self::Iterator&lt;'a&gt;;
}
</code></pre>
<p>Here, <code>where Self: 'a</code> is required on <code>Item</code> because of <code>iter</code>. However, <code>Item</code>
is used in the bounds of <code>Iterator</code>, the <code>where Self: 'a</code> clause is also required
there.</p>
<p>Finally, any explicit uses of <code>'static</code> on GATs in the trait do not count towards
the required bounds.</p>
<pre><code class="language-ds">trait StaticReturn {
    type Y&lt;'a&gt;;
    fn foo(&amp;self) -&gt; Self::Y&lt;'static&gt;;
}
</code></pre>
<h2 id="associated-constants"><a class="header" href="#associated-constants">Associated Constants</a></h2>
<p><em>Associated constants</em> are <a href="items/constant-items.html">constants</a> associated with a type.</p>
<p>An <em>associated constant declaration</em> declares a signature for associated
constant definitions. It is written as <code>const</code>, then an identifier,
then <code>:</code>, then a type, finished by a <code>;</code>.</p>
<p>The identifier is the name of the constant used in the path. The type is the
type that the definition has to implement.</p>
<p>An <em>associated constant definition</em> defines a constant associated with a
type. It is written the same as a <a href="items/constant-items.html">constant item</a>.</p>
<p>Associated constant definitions undergo <a href="items/../const_eval.html">constant evaluation</a> only when
referenced. Further, definitions that include <a href="items/generics.html">generic parameters</a> are
evaluated after monomorphization.</p>
<h3 id="associated-constants-examples"><a class="header" href="#associated-constants-examples">Associated Constants Examples</a></h3>
<p>A basic example:</p>
<pre><code class="language-ds">trait ConstantId {
    const ID: i32;
}

struct Struct;

impl ConstantId for Struct {
    const ID: i32 = 1;
}

fn main() {
    assert_eq!(1, Struct::ID);
}
</code></pre>
<p>Using default values:</p>
<pre><code class="language-ds">trait ConstantIdDefault {
    const ID: i32 = 1;
}

struct Struct;
struct OtherStruct;

impl ConstantIdDefault for Struct {}

impl ConstantIdDefault for OtherStruct {
    const ID: i32 = 5;
}

fn main() {
    assert_eq!(1, Struct::ID);
    assert_eq!(5, OtherStruct::ID);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="inheritance-1"><a class="header" href="#inheritance-1">Inheritance</a></h1>
<p>This section describes operations used when working with struct inheritance.</p>
<h2 id="cast"><a class="header" href="#cast">Cast</a></h2>
<p>A cast from an object to a type <code>T</code> in terms of inheritance succeeds if the object is equals to or is a subtype of <code>T</code>.</p>
<p>There are two operations for casting:</p>
<ul>
<li>The <code>cast!(node, T)</code>: casts <code>node</code> into <code>T</code> by panicking on failure.</li>
<li>The <code>try_cast!(node, T)</code>: casts <code>node</code> into <code>T</code> by returning <code>Result&lt;T, CastError&gt;</code>.</li>
</ul>
<p>Examples:</p>
<pre><code class="language-ds">if let Ok(button) = try_cast!(object, Button) {
    // button: Button
}
</code></pre>
<h2 id="relationship"><a class="header" href="#relationship">Relationship</a></h2>
<p>The <code>is_type!(node, T)</code> operator determines if <code>node</code> is of type <code>T</code> or a subtype of <code>T</code>.</p>
<h2 id="restrictions"><a class="header" href="#restrictions">Restrictions</a></h2>
<p>The <code>cast!</code>, <code>try_cast!</code> and <code>is_type!</code> operators do not accept the following types as second argument:</p>
<ul>
<li><code>Option&lt;T&gt;</code></li>
<li><code>[T]</code></li>
<li><code>fn</code></li>
<li><code>Map&lt;T&gt;</code></li>
<li><code>WeakMap&lt;T&gt;</code></li>
<li><code>Set&lt;T&gt;</code></li>
<li>Generic external structs</li>
<li>Generic external traits</li>
</ul>
<p>For <code>Option&lt;T&gt;</code> in particular, these operators treat <code>Option&lt;T&gt;</code> as <code>T</code>, as described in <a href="inheritance.html#special-behavior">Special Behavior</a>.</p>
<h2 id="special-behavior"><a class="header" href="#special-behavior">Special Behavior</a></h2>
<p>The <code>cast!</code>, <code>try_cast!</code> and <code>is_type!</code> operators have the following special behaviors:</p>
<ul>
<li>They naturally take an <code>Option&lt;T&gt;</code> value as <code>T</code>.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="serialization"><a class="header" href="#serialization">Serialization</a></h1>
<p>DS includes general serialization by use of the standard library's <code>ds::ser</code> module. &quot;ser&quot; is an abbreviation for serialization.</p>
<p>The <code>ser</code> attribute is included in the prelude.</p>
<h2 id="serializable"><a class="header" href="#serializable">Serializable</a></h2>
<p>The <code>Serializable</code> trait indicates that a type is serializable and deserializable. The language does not allow the user to implement this trait; it must be derived on a struct or enum instead.</p>
<p>Example:</p>
<pre><code class="language-ds">#[derive(Serializable)]
struct S {
    x: f64,
    y: f64,
}
</code></pre>
<p>A struct field can declare a serialized name using <code>#[ser(name = &quot;serialized_name&quot;)]</code>:</p>
<pre><code class="language-ds">#[derive(Serializable)]
struct S {
    x: f64,
    #[ser(name = &quot;serialized_name&quot;)]
    y: f64,
}
</code></pre>
<h2 id="serialization-for-enumerations"><a class="header" href="#serialization-for-enumerations">Serialization for enumerations</a></h2>
<p><em>Discriminant enumeration:</em> The discriminant type of an enumeration that is serialized by discriminant must be either <code>str</code>, <code>f64</code>, <code>u32</code> or <code>i32</code>.</p>
<pre><code class="language-ds">#[derive(Serializable)]
#[discriminant(str)]
pub enum E {
    Variant1 = &quot;variant1&quot;,
}
</code></pre>
<p><em>Structural enumeration:</em> Structural enumerations must specify a type property and their discriminant type must be <code>str</code>. The type property is specified through the <code>#[ser(type_property = &quot;type&quot;)]</code> attribute.</p>
<pre><code class="language-ds">#[derive(Serializable)]
#[ser(type_property = &quot;type&quot;)]
#[discriminant(str)]
pub enum Enum {
    Point { x: f64, y: f64 } = &quot;point&quot;,
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
